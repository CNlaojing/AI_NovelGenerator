# 📖 自动小说生成工具

  **打包项目下载**
    - 自行打包<br>
    - 关注加一键三连后咨询UP<br>
    - 淘宝店铺购买<br>
    - 群友互助，Q群：1039191350<br>

# AI_NovelGenerator (CNlaojing Fork)  
> 基于 YILING0013/AI_NovelGenerator 的中文本地化增强版本，新增多模型适配与向量库优化功能  
## 📌 项目说明  
本项目是 [YILING0013/AI_NovelGenerator](https://github.com/YILING0013/AI_NovelGenerator)  的 Fork 分支，由 CNlaojing 维护。 
✨ **核心功能** ✨

| 功能模块 | 关键能力 |
| :--- | :--- |
| **🎨 小说设定工坊** | 世界观架构 / 角色设定 / 剧情蓝图 |
| **📖 智能章节生成** | 多阶段、可定制的章节内容生成 |
| **🧠 状态追踪系统** | 动态追踪角色发展轨迹与伏笔状态 |
| **� 轻量化JSON数据库** | 使用JSON文件替代向量库，轻松管理人设与伏笔，易于备份和修改 |
| **📚 知识库集成** | 支持导入本地文档作为创作参考 |
| **✅ 自动审校机制** | 智能检测剧情矛盾与逻辑冲突 |
| **🚀 自动化工作流** | 一键启动，全自动执行多项生成任务 |
| **🖥️ 可视化工作台** | 全流程GUI操作，配置、生成、审校一体化 |

</div>

> 一款基于大语言模型的多功能小说生成器，助您高效创作逻辑严谨、设定统一的长篇故事

## 🔄 更新日志
- V1.7.3(2025-09-29)
   - **核心架构升级**：使用JSON文件全面替代向量数据库来管理角色和伏笔状态，简化了部署和数据管理。
   - **UI增强**：在“自动生成”页面添加了信息显示窗口，提升了用户交互体验。
   - **Bug修复**：修复了若干数据提取相关的BUG，增强了系统的稳定性。
   
- V1.7.2(2025-09-20)
   - 轮询添加功能
   - 修复部分BUG
   - 修改部分提示词

- V1.7.1(2025-09-17)
   - 修复部分LLM会Cloudflare拦截，导致返回内容出错问题
   - 修复日志token不显示问题
   - 输出日志窗口添加LLM读秒功能，允许返回内容时拖动滚动条功能
   - 修复保存地址项目地址不保存问题，
   - 删除软件默认缓存残留

- V1.7.0(2025-09-14)
   - 修改大模型设置方式
   - 添加轮询模式功能
   - 添加自动生成功能
   - 修改部分提示词
   - 修复已知bug

- V1.6.4(2025-08-16)
   - 修复有时不能生成后续章节目录问题
   - 生成目录时弹出提示词弹窗，以便用户修改提示词
   - 修复生成分卷时，卷头的章节分布与分卷大纲中的章节分布不一致问题
   - 生成草稿时，添加前N章章节正文为作为提示词功能，默认为1，需注意提示词弹窗显示字数，需按照LLM模型能力自行调整字数
   - 修改章节正文保存文件夹为中文“章节正文”，修改章节正文保存文件名为 “章节号 章节名.txt” 格式
   - 在章节正文页面添加将所有章节导出成单独文本文档功能
   - 在章节正文页面添加正文排版功能（慎用，排版后，人工检查完确定没问题再点保存）
   - 修改部分提示词变量提取错误问题
   - 修改部分提示词
   - 修复UI界面 章节数 显示宽度，避免4位数章节显示不全
   - 修改 章节号、分卷数、章节数、每章字数 内容后，会自动保存配置文件，无需手动保存

- V1.6.2(2025-07-27)
   - 生成架构时弹出提示词弹窗，以便用户修改提示词
   - 修改生成目录的格式，让章节目录更详细
   - 添加关于软件界面，显示README.md

- V1.6.1(2025-07-25)
   - 修改部分自己搭设模型带防火墙，仅能识别网页内容都情况

- V1.6.0(2025-07-19)
   - 新增向量库管理界面
   - 修复输出日志显示方式
   - 修复部分bug

- v1.5.5(2025-07-17)
   - 修改日志显示方式
   - 增加mac版本
   - 修改伏笔状态

- V1.5.4(2025-06-26)
   - 修改生成目录时关于伏笔状态的提取方式
   - 修改剧情要点不能正常提取问题
   - 修改角色数据库格式混乱问题
   - 修复部分内容显示错误问题
   - 修改部分提示词

- V1.5.2(2025-06-24)
   - 修改终端LLM返回内容以流式显示方式显示
   - 修复Gemini模型不能正常使用问题
   - 修改部分日志为中文
   - 修改部分提示词
   
- V1.5.2(2025-06-14)
   - 修改大模型模型名称为自动获取平台可使用模型列表（部分平台不支持列表获取）
   - 新增“修复 角色数据库”功能，在角色数据库损坏或误删时，可分析角色向量库重建角色数据库文件<br>
   - 修改定稿时处理角色状态检索角色状态方式，修改为使用LLM分析角色数据库与本章内容方式提取角色ID<br>
   - 修复提示词弹窗消失最小化问题<br>
   - 修复提示词提取章节字数与类型错误问题<br>
   - 修复打包软件向量错误问题<br>
   - 修改部分提示词<br>

- V1.5.1 (2025-06-04)
   - 修复定稿时处理角色向量库与伏笔向量库的问题<br>
   - 添加查看审校结果编辑窗<br>
   - 添加查看剧情要点编辑窗的编辑保存功能<br>
   - 添加打开项目路径文件夹按钮<br>
   - 修复提示词弹窗最小化问题<br>

- V1.5.0 (2025-06-01)<br>
  - 完善角色状态自动更新<br>
  - 优化伏笔追踪系统<br>
  - 修复章节草稿生成bug<br>
  - 定稿后自动更新章节号<br>
   1、每个主要步骤添加了提示词编辑窗并附带字数显示，用户可根据自己的喜好，修改提示词后，点击生成即可调用LLM生成对应内容<br>
   2、修改主要步骤的提示词与生成格式，包括但不限于：分卷大纲、章节目录、章节草稿、小说改写、章节定稿、剧情要点、前情摘要等<br>
   3、因没有完善的提示词进行向量库检索出对于生成小说设定、分卷大纲、章节目录、章节正文、定稿等情况下有用的知识库内容，所以删除了导入知识库与知识库检索功能<br>
   4、将向量库修改为角色数据库与伏笔向量库，角色向量库用于存储角色的基本信息，伏笔向量库用于存储伏笔的状态信息<br>
   5、角色状态与伏笔状态均使用唯一编号进行检索与向量化<br>
   6、修改分卷大纲生成方式<br>
   - 生成第1卷时，会根据用户填写的数量，生成第1卷所需的角色基础状态进提示词<br>
   - 生成后续卷时，会根据用户填写权重数值，检索向量库内≥阈值的角色状态进提示词<br>
     注意：推荐生成完整第一卷章节正文后，再使用最新状态的角色状态作为提示词生成后续分卷大纲<br>
   7、修改生成目录生成方式<br>
   - 由用户填写的数量来按段生成对应章节目录<br>
   - 由用户填写的权重数值，检索向量库内≥阈值的角色状态进提示词<br>
   - 修改章节目录格式，新增伏笔系统<br>
     注意：推荐生成完整一段目录章节正文后，在使用对应的角色状态作为提示词生成后续章节目录<br>
   章节目录的伏笔系统<br>
      - 修改章节目录格式，主要添加伏笔条目<br>
      - 伏笔条目会根据已有伏笔的编号与状态增量添加，确保伏笔状态能衔接<br>
   章节目录提取角色状态<br>
      - 生成章节目前，根据用户填写的数值来提取当前最新章节前N章有出场，且权重数值≥阈值的角色状态<br>
      - 根据角色数据库检索出所需角色ID，使用角色ID从向量库检索出角色状态进提示词<br>
   8、一致性审校提示词修改<br>
   - 一致性审校后，将把审校结果保存至一次性审校.txt文件中<br>
   9、新增改写章节功能<br>
   - 改写章节提取一次性审校内容，使用一次性审校内容作为改写提示词<br>
   - 改写章节后，会自动更新对应章节正文文件<br>
   10、定稿章节功能<br>
   - 删除定稿时字数检验，更改为独立的改写章节功能<br>
   - 修改定稿时提取的前情摘要提示词与格式<br>
   - 修改定稿时检索角色状态的方式与格式，并向量化最终角色进入向量库<br>
   - 新增定稿时检索章节对应伏笔并把伏笔内容更新至伏笔向量库<br>
   - 修改定稿时剧情要点的提取的提示词与格式<br>
   11、修改角色库功能<br>
   - 修改角色库内角色的格式等<br>
         
- 2023-04-12 添加分卷功能，按分卷生成章节目录，修复剧情要点<br>
- 2023-03-09 添加字数显示<br>
- 2023-03-05 添加角色库功能<br>
---
##  生成小说步骤推荐
修改使用角色状态作为提示词生成分卷大纲、章节目录的方式，所以推荐逐步生成的方式来生成小说，<br>
以便能更好的衔接上下文<br>
1、先生成小说设定<br>
2、生成第1卷分卷大纲<br>
3、生成第一段章节目录<br>
4、完成第一段章节目录所有正文后，再使用最新的角色状态生成第二段章节目录<br>
5、完成第一卷所有章节后，再使用最新的角色状态生成后续分卷大纲<br>
6、循环生成后续卷至最终卷

## 📑 目录导航
1. [环境准备](#-环境准备)  
2. [安装说明](#-安装说明)
3. [项目架构](#-项目架构)  
4. [配置指南](#⚙️-配置指南)  
5. [运行说明](#-运行说明)  
6. [使用教程](#-使用教程)  
7. [疑难解答](#-疑难解答)  

---

## 🛠 环境准备
确保满足以下运行条件：
- **Python**: 3.9+ (推荐 3.10 ~ 3.13)
- **API 密钥**: 准备一个或多个大语言模型服务的有效API密钥 (例如 OpenAI, DeepSeek, Ollama 等)

---

## 📥 安装说明
1.  **克隆项目**
    ```
    git clone https://github.com/CNlaojing/AI_NovelGenerator.git
    ```

2. **安装编译工具（可选）**  
   - 如果对某些包无法正常安装，访问 [Visual Studio Build Tools](https://visualstudio.microsoft.com/zh-hans/visual-cpp-build-tools/) 下载并安装C++编译工具，用于构建部分模块包；
   - 安装时，默认只包含 MSBuild 工具，需手动勾选左上角列表栏中的 **C++ 桌面开发** 选项。

3. **安装依赖并运行**  
   - 打开终端，进入项目源文件目录：
     ```bash
     cd AI_NovelGenerator
     ```
   - 安装项目依赖：
     ```bash
     pip install -r requirements.txt
     ```
   - 安装完成后，运行主程序：
     ```bash
     python main.py
     ```
    
>如果缺失部分依赖，后续**手动执行**
>```bash
>pip install XXX
>```
>进行安装即可

## 🗂 项目架构
```
AI_NovelGenerator/
├─main.py                      # 入口文件, 运行 GUI
├─ui/                          # 图形界面模块
│  ├─main_window.py            # 主窗口
│  ├─chapters_tab.py           # 章节管理标签页
│  ├─character_tab.py          # 角色管理标签页
│  └─...                       # 其他UI组件
├─novel_generator/             # 核心生成模块
│  ├─architecture.py           # 小说架构生成
│  ├─chapter.py                # 章节生成
│  ├─character_generator.py    # 角色生成
│  ├─consistency_checker.py    # 一致性检查
│  ├─json_utils.py             # JSON数据库工具
│  └─...                       # 其他生成组件
├─llm_adapters.py              # LLM 接口封装
├─embedding_adapters.py        # Embedding 接口封装
├─prompt_definitions.py        # 定义 AI 提示词
├─utils.py                     # 常用工具函数
├─config_manager.py            # 管理配置
├─config.json                  # 用户配置文件
└─requirements.txt             # 项目依赖
```

---

## ⚙️ 配置指南
本工具采用可视化的UI驱动配置，无需手动编辑JSON文件。所有配置都在软件内的 **“模型设置”** 页面完成。

### 1. 创建模型配置
1.  **进入“模型设置”页面**：启动软件后，点击顶部的“模型设置”标签页。
2.  **新增配置**：
    *   在“配置名称”输入框中为你的一套模型设置一个名称 (例如 `MyGPT4o`)。
    *   在左侧的 **LLM 配置**区域，选择你的模型服务商 (如 `OpenAI`, `Ollama`, `DeepSeek` 等)。
    *   填写 `API Key` 和 `Base URL`。软件已为多数服务商预设了默认URL。
    *   点击 **“获取可用模型”** 按钮，软件会自动刷新并列出该接口支持的模型，然后在下拉菜单中选择一个。
    *   根据需要调整 `Temperature` (创意度) 和 `Max Tokens` (最大生成长度) 等参数。
3.  **配置 Embedding 模型** (用于文本嵌入，可选)：
    *   在右侧的 **Embedding 配置**区域，选择并填写对应的服务信息。虽然项目核心数据不再依赖向量库，但在某些辅助功能中可能仍需使用Embedding模型。
4.  **保存与测试**：
    *   点击 **“保存配置”** 按钮，你的设置将被保存。
    *   使用 **“测试LLM配置”** 和 **“测试Embedding配置”** 按钮来验证你的设置是否正确。

### 2. 设置默认配置
你可以创建多套模型配置。选中一个最常用的配置，然后点击 **“设为默认”**，软件下次启动时将自动加载该配置。

### 3. 轮询模式 (高级功能)
如果你拥有多个模型或账户，可以启用轮询模式来分担请求压力或对比不同模型的效果。
1.  **添加配置到列表**：在“轮询设置”区域，从下拉菜单中选择一个已保存的配置，然后点击 **“添加到轮询列表”**。此操作可添加多个。
2.  **选择策略**：选择“顺序轮询”或“随机轮询”。
3.  **启用轮询**：回到 **“主页”**，勾选 **“启用轮询模式”** 复选框。此后，所有生成任务将根据你的设置在多个模型配置之间自动切换。

---

## 🚀 运行说明
### **方式 1：使用 Python 解释器**
```bash
python main.py
```
执行后，GUI 将会启动，你可以在图形界面中进行各项操作。

### **方式 2：打包为可执行文件**
如果你想在无 Python 环境的机器上使用本工具，可以使用 **PyInstaller** 进行打包：

```bash
pip install pyinstaller
pyinstaller main.spec
```
打包完成后，会在 `dist/` 目录下生成可执行文件（如 Windows 下的 `main.exe`）。

---

## 📘 使用教程

### 1. 初始配置
1. **启动软件**
   - 双击`main.py`或在命令行中运行`python main.py`
   - 软件启动后会显示主界面，包含多个功能标签页

2. **配置API参数**
   - 点击顶部的"配置"标签页
   - 在左侧选择LLM接口格式（OpenAI/DeepSeek/Ollama等）
   - 填写相应的API密钥（API Key）
   - 填写API基础URL（如OpenAI为https://api.openai.com/v1）
   - 选择模型名称（如gpt-4o-mini、gpt-3.5-turbo等）
   - 设置温度参数（Temperature，0.1-1.0，越低越保守）
   - 设置最大生成长度（Max Tokens，建议4096-8192）
   - 设置超时时间（Timeout，建议600秒）

3. **配置Embedding参数**
   - 在同一标签页右侧设置Embedding参数
   - 选择Embedding接口格式（通常与LLM相同）
   - 填写Embedding API密钥（可与LLM相同）
   - 填写Embedding基础URL
   - 选择Embedding模型（如text-embedding-ada-002）
   - 设置检索数量（Retrieval K，建议4-8）

4. **设置保存路径**
   - 点击"浏览"按钮选择一个空白目录作为项目保存路径
   - 确保该目录有足够的空间和写入权限
   - 点击"保存配置"按钮保存所有设置

5. **测试配置**
   - 点击"测试LLM配置"和"测试Embedding配置"按钮
   - 确认配置正确，测试结果显示"成功"后再进行下一步

### 2. 项目创建
1. **填写小说基本信息**
   - 点击"小说参数"标签页
   - 填写主题/Topic（如"废土世界的AI叛乱"）
   - 选择类型/Genre（如"科幻"、"奇幻"、"武侠"等）
   - 设置总章节数
   - 设置每章字数
   - 设置分卷数量
   
2. **添加创作指导**
   - 在"用户指导"文本框中添加创作风格、内容限制等要求
   - 可以指定特定的写作风格、禁忌内容、核心人物等
   - 这些指导将贯穿整个创作过程

### 3. 小说生成步骤

1. **生成小说架构**
   - 点击主页标签页上的"生成小说架构"按钮
   - 系统开始自动生成以下内容（过程可能需要几分钟）:
     - 核心种子：小说的核心概念和主题
     - 角色动力学：主要角色关系和冲突
     - 世界观设定：故事发生的背景和规则
     - 多幕式架构：整体剧情框架
   - 生成完成后，点击"小说架构"标签页查看详细内容
   - 如果对设定不满意，可以在“小说架构”页面编辑后点击"保存设定"按钮

2. **生成分卷大纲**
   - 在主页标签页点击"生成分卷"按钮
   - 系统根据之前设置的分卷数量生成分卷的主要内容和主题
   - 当生成第1卷时，会根据用户填写的数量先生成第1卷所需的角色基础状态进提示词
   - 当生成后续卷时，会根据用户填写权重数值，从 `角色状态.md` 文件中读取≥阈值的角色状态进提示词
   - 在提示词弹窗修改好提示词后，确认生成即可调用LLM生成对应分卷大纲
   - 以此类推，直到生成所有分卷
   - 生成完成后，点击"小说分卷"标签页查看结果
   - 每个分卷包含主题、核心冲突、关键角色和主要事件
   - 可以在分卷页面编辑内容并点击"保存修改"按钮
   - 为了小说整体连贯，建议在生成第1卷分卷大纲后，完成所有第1卷章节正文后再生成后续分卷，以便系统可根据最新的角色状态，生成后续分卷大纲

3. **生成章节目录**
   在主页标签页点击"生成目录"按钮，会弹出确认窗口
   确认窗口参数：
      - 按数量生成：指定要生成的章节数量，推荐20章以下
      - 设置角色提取参数（前N章和权重阈值）
      - 系统会根据用户设置的参数，检索角色数据库.txt文件中，提取前N章中有出场≥阈值的ID
      - 根据角色ID从 `角色状态.md` 文件中读取≥阈值的角色状态进提示词
   提示词编辑窗：
      - 弹出提示词编辑窗前，系统会分析已生成的“角色状态.txt”文件，分析出已有章节的伏笔状态
      - 包含：
         - 当前所有未回收伏笔的基本信息，
         - 当前每种类型伏笔的最大编号，
         - 现需生成范围内必须回收的伏笔的状态
         - 提示词编辑窗内，会根据角色ID从 `角色状态.md` 文件中读取≥阈值的角色状态进提示词
      - 用户修改好提示词后，确认生成即可调用LLM生成对应数量章节目录，并按照最新角色状态、前三章章节目录、小说分卷、伏笔历史信息等设定来确保后续章节大纲能够衔接
   - 系统会根据每次生成完成的章节大纲，自动分析伏笔状态，并更新“伏笔状态.txt”文件中
   - 生成完成后，点击"小说目录"标签页查看结果
   - 目录包含每章的标题、简要描述和涉及角色
   - 修改章节目录后，可点击生成目录按钮，即可自动清空旧版的”伏笔状态.txt”文件，重新生成新的伏笔状态
   - 可以在目录页面编辑内容并点击"保存目录"按钮

4. **生成章节草稿**
   - 主界面章节号编辑框填写需要生成的章节号
   - 点击"生成草稿"按钮
   - 系统会先分析当前章节基本信息、分卷大纲、前情摘要、角色数据库等信息分析生成草稿所需的角色信息
   - 分析内容：
      - 从角色数据库中分析出本章需要的角色并提取该角色ID
      - 除角色数据库内的角色外，是否需要增加新的角色
      - 使用LLM生成本章所需新角色的基本信息，并导入待用角色文件
      - 使用角色ID从 `角色状态.md` 文件中读取角色状态并导入待用角色文件
      - 将待用角色文件内的角色状态，填充进生成草稿提示词内，并弹出编辑框
   - 用户修改好提示词后，确认生成即可调用LLM生成对应章节草稿
   - 生成完成后，草稿会保存至保存路径下的文件夹中并显示在右侧编辑框中供用户改写、一致性审校、定稿等操作
   - 点击“章节正文”标签页查看章节正文结果
   - 修改后点击"保存"按钮保存当前版本

5. **一致性审校**
   - 在主界面点击“一致性审校”按钮
   - 系统根据当前审校章节的基本信息，分析出本章伏笔的伏笔编号
   - 根据伏笔编号，从 `伏笔状态.md` 文件中读取对应伏笔的历史信息填充进提示词，
   - 提示词包含：章节基本信息、分卷大纲、前情摘要、上一章剧情要点、伏笔的历史内容等
   - 根据提示词，调用LLM进行内容一致性审校
     - 角色行为是否符合设定
     - 情节是否与前文连贯
     - 世界观设定是否一致
     - 伏笔是否符合设计原则，是否与历史伏笔有效衔接
   - 审校完成后，会把审校结果保存至一致性审校文件夹内

6. **章节改写**
   - 在主界面点击“改写章节”按钮
   - 系统会根据当前章节的基本信息，并提取一致性审校文件夹内的审校结果进提示词
   - 在弹出的改写提示词窗口中查看提示词是否符合预期或输入改写指导（如改变风格、增加细节等）
   - 点击"确认改写"按钮开始改写
   - 改写完成后，新版本会显示在编辑框中并覆盖保存至对应文件中

7. **章节定稿**
   - 确认内容编辑框内的内容已经满意
   - 或者复制修改后的内容至内容编辑框内
   - 填写正确的章节号
   - 点击"定稿章节"按钮
   - 系统会执行以下操作：
     - 提取章节中的剧情要点
     - 检索本章出现的角色，并检索角色数据库内已有角色ID
     - 从 `角色状态.md` 文件中读取本章已有角色状态，并更新
     - 将更新后的角色状态与新角色信息，一起保存回 `角色状态.md` 文件
     - 提取本章伏笔的历史内容，分析出本章新的伏笔进展，并整合
     - 将整合后的伏笔内容与新伏笔，一起保存回 `伏笔状态.md` 文件

8. **管理角色库**
   - 系统会根据生成的内容自动提取小说中的角色
   - 点击类型标签页按钮看所有角色信息
   - 支持手动添加新角色：点击角色对应权重按钮，即可生成对应权重新角色基本格式
   - 支持编辑现有角色：点击角色行后的"编辑"按钮
   - 支持删除角色：点击角色行后的"删除"按钮
   - 编辑完成后点击"保存角色库"按钮

9. **后期修改**
   - 可随时修改已定稿章节：
     - 在章节页面选择需要修改的章节
     - 编辑内容后点击"保存草稿"按钮
     - 如有必要，可以重新进行章节改写
     - 如非必要，请勿重新定稿非最新章节
   - 注意：重新定稿非最新章节可能会影响伏笔与角色状态的连贯性

10. **使用自动化工作流 (不推荐)**
当你熟悉了基本流程后，可以使用“自动生成”功能来极大提升效率。
1.  **打开面板**: 在 **“主页”** 点击 **“自动生成”** 按钮。
2.  **配置任务**:
    *   设置你想一次性生成的 **章节数量**。
    *   勾选需要执行的流程，例如，你可以让它自动完成“生成草稿” -> “一致性审校” -> “改写章节” -> “定稿章节” 的全套操作。
3.  **启动引擎**: 点击 **“启动引擎”**，软件将开始全自动执行你设定的任务流，并实时显示日志。

---

## ❓ 疑难解答

### API和连接问题

#### Q1: 出现 "Expecting value: line 1 column 1 (char 0)" 错误
该问题通常由API未正确响应造成，可能是API返回了HTML或其他非JSON内容。

**解决方法**：
- 检查API密钥是否正确输入，没有多余的空格或换行
- 确认API服务是否可用（可访问官方状态页面查看）
- 检查API基础URL是否正确（例如OpenAI应为https://api.openai.com/v1）
- 尝试更换API服务提供商
- 检查网络连接，确保没有代理或防火墙阻止
- 重启软件，重新加载配置

#### Q2: 出现 "HTTP/1.1 504 Gateway Timeout" 或其他超时错误
这表明API服务器响应超时，可能是网络问题或服务器负载过高。

**解决方法**：
- 确认网络连接稳定，尝试ping API服务器
- 检查API服务是否正常运行（查看官方状态页面）
- 在配置页面增加超时参数值（建议设置为600秒或更高）
- 减小生成内容的长度（降低max_tokens值）
- 尝试在网络状况较好的时段使用
- 如使用代理，检查代理服务是否稳定

#### Q3: 模型返回内容不完整或被截断
这通常是因为模型生成的内容超过了设定的最大token限制。

**解决方法**：
- 增加max_tokens参数值（在配置页面调整）
- 减少每章的目标字数
- 使用支持更长上下文的模型（如gpt-4-turbo）
- 将长章节拆分为多个较短的章节

#### Q3: `角色状态.md` 或 `伏笔状态.md` 文件相关问题

**解决方法**：
- **文件损坏**：如果出现JSON解析错误，说明文件可能已损坏。请尝试从备份中恢复，或手动打开文件检查并修复语法错误（如缺少逗号、括号等）。
- **权限问题**：确保程序对项目文件夹有读写权限，特别是 `定稿内容` 子目录。
- **数据不一致**：由于数据现在是明文存储，请谨慎手动编辑，避免破坏数据结构。如果角色或伏笔状态出现逻辑混乱，可以尝试回退到上一个版本的JSON文件。

### 功能和使用问题

#### Q4: 如何切换不同的LLM或Embedding提供商？

**解决方法**：
1. 点击"配置"标签页
2. 在左侧LLM配置区域，选择不同的接口格式：
   - OpenAI（支持GPT系列模型）
   - DeepSeek（支持DeepSeek系列模型）
   - Ollama（支持本地部署的开源模型）
   - 智谱AI（支持GLM系列模型）
   - 火山引擎（支持火山引擎提供的模型）
3. 填写相应的API密钥和基础URL
4. 选择适合的模型名称
5. 同样方式配置右侧的Embedding参数
6. 点击"保存配置"按钮
7. 使用"测试LLM配置"和"测试Embedding配置"按钮验证配置是否正确

#### Q5: 生成的内容质量不理想，如何提高？

**解决方法**：
- 使用更强大的模型（如GPT-4、Claude-3等）
- 调整temperature参数（降低至0.1-0.5可获得更稳定输出）
- 在"小说参数"页面提供更详细的用户指导和创作要求
- 在生成章节前，确保小说设定、分卷大纲和章节目录内容丰富且连贯
- 利用一致性审校功能检查并修正问题
- 导入相关知识库资料提供参考（如历史背景、专业知识等）
- 对重要章节使用改写功能，提供具体的改进指导

#### Q6: 生成速度太慢，如何加快？

**解决方法**：
- 使用本地部署的模型（如通过Ollama运行Llama、Mistral等模型）
- 减小每章的目标字数（在"小说参数"页面调整）
- 降低max_tokens参数值（但注意不要太低导致内容被截断）
- 使用响应更快的API服务或选择更快的模型（如gpt-3.5-turbo）
- 确保网络连接稳定，可能的话使用有线连接
- 关闭不必要的应用程序，释放系统资源

#### Q7: 角色库中的角色信息丢失或不一致

**解决方法**：
- 检查"角色数据库.txt"文件是否存在且格式正确
- 在角色标签页中手动添加或编辑丢失的角色信息
- 确保每次编辑后点击"保存角色库"按钮
- 避免在多个实例中同时编辑角色信息
- 如果问题严重，可以从备份中恢复角色数据库文件

#### Q8: 文件保存路径问题

**解决方法**：
- 确保在配置页面设置了有效的文件保存路径
- 检查该路径是否有写入权限
- 避免使用包含特殊字符的路径
- 如果路径太长，尝试使用更短的路径
- 确保磁盘有足够的空间

#### Q9: 如何彻底移除旧版向量库相关功能？

**解决方法**：
在项目从旧版的向量库迁移到新版的JSON文件存储后，您可能会看到一些用于数据迁移的旧版功能按钮。如果您确认不再需要这些功能，可以使用“清除旧版数据”按钮来彻底清理。
- **位置**：该按钮位于 **“数据查看”** 标签页。
- **功能**：点击后，它会执行一次性清理操作：
    1. 从所有模型配置中移除不再需要的 **Embedding模型设置**。
    2. 永久隐藏“转换旧项目为MD格式”和“清除旧版数据”这两个按钮。
    3. 从UI中移除“Embedding 模型设置”标签页。
- **注意**：此操作 **不可逆**，执行后需要 **重启软件** 才能使所有更改完全生效。建议在完全熟悉新版JSON工作流后再执行此操作。

---

---

如有更多问题或需求，欢迎在 
[项目Issues](https://github.com/YILING0013/AI_NovelGenerator/issues) 
[项目Issues](https://github.com/CNlaojing/AI_NovelGenerator/issues) 
中提出。

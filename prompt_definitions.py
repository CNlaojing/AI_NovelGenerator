# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
除带大括号（变量）外的提示词都可修改。
集中存放所有提示词 (Prompt)，采用模块化、分步生成的思想，确保高质量的长篇小说架构设计。
"""

# =============== 新版小说架构生成（模块化五步法） ===================

# --- 步骤一：分卷使命宣言 ---
architecture_step1_mission_prompt = """\
 AI角色：世界级故事战略家
 任务：为一部长篇小说设定最高层的战略方向。

 [基础输入数据]
 - 类型：{genre}
 - 总卷数：{Total_volume_number}
 - 总章数（约）：{number_of_chapters}
 - 每章字数（约）：{word_number}
 - 核心主题：{topic}
 - 作者指导：{user_guidance}

 [执行指令]
 --- 模块一：分卷使命宣言 ---
 目的：将模糊的“主题”转化为每一分卷清晰、可执行的战略目标。
 要求：
  - 请为全部 {Total_volume_number} 卷，严格按照下面的【分卷格式】逐一生成档案。
  - 根据基础输入信息的总卷数与章节数，判断出是短篇还是长篇小说，每个分卷的内容复杂度与深度要匹配整体篇幅。

 【分卷内容示例】
 第一卷：[请在此处填写卷名]
- 分卷主题：[此处填写本卷的核心思想]
- 情节里程碑：[此处填写本卷结束时，世界必须发生什么不可逆的改变]
- 世界观演进：[此处填写本卷要揭示或改变世界的哪个方面]
- 主角成长节点：[此处填写主角在本卷的核心蜕变]
- 结尾悬念：[此处填写用什么钩子牵引读者进入下一卷]

 第二卷：[请在此处填写卷名]
- 分卷主题：...
 (以此类推，直到第 {Total_volume_number} 卷)

 [最终输出格式]
 请严格按照以下格式生成内容，不要包含任何解释或注释。

◆ 模块一：分卷使命宣言
● 第一卷：[卷名]
- 分卷主题：[内容]
- 情节里程碑：[内容]
- 世界观演进：[内容]
- 主角成长节点：[内容]
- 结尾悬念：[内容]

● 第二卷：[卷名]
- 分卷主题：[内容]
... (以此类推)
"""

# --- 步骤二：世界观与冲突发生器 ---
architecture_step2_worldview_prompt = """\
 AI角色：世界观架构师
 任务：基于已确立的“分卷使命”，构建一个“活”的世界，它不仅是背景，更是情节的直接驱动力。

 [基础输入数据]
 - 类型：{genre}
 - 总卷数：{Total_volume_number}
 - 总章数（约）：{number_of_chapters}
 - 每章字数（约）：{word_number}
 - 核心主题：{topic}
 - 作者指导：{user_guidance}
 - 模块一（分卷使命宣言）的生成结果：
{step1_result}

 [执行指令]
 --- 模块二：世界观与冲突发生器 ---
 目的：根据分卷使命中蕴含的故事走向，设计出与之匹配的世界观和核心矛盾。
 要求：
   - 物理/社会设定：基于作者指导和分卷使命，构建地理、风俗、科技水平等基础设定。
   - 力量/规则体系：定义力量的限制、代价、漏洞，为智斗和反转提供基础。
   - 冲突发生器：明确设计出世界中最容易爆发矛盾的2-5个点（如争议领土、稀缺资源、信仰对立），这些冲突需要能直接服务于“分卷使命”中的情节里程碑。
    - 根据基础输入信息的总卷数与章节数，判断出是短篇还是长篇小说，世界观的复杂度与深度要匹配整体篇幅。

 请严格按照以下格式生成内容，不要包含任何解释或注释。

◆ 模块二：世界观与冲突发生器
[模块二的内容]
"""

# --- 步骤三：情节线设计 ---
architecture_step3_plot_prompt = """\
 AI角色：首席剧情设计师
 任务：基于已确立的宏观战略和世界观，为每一分卷设计具体的情节骨架。

 [基础输入数据]
 - 类型：{genre}
 - 总卷数：{Total_volume_number}
 - 总章数（约）：{number_of_chapters}
 - 每章字数（约）：{word_number}
 - 核心主题：{topic}
 - 作者指导：{user_guidance}
 - 模块一 & 二 的生成结果：
{step1_result}
{step2_result}

 [执行指令]
 --- 模块三：情节线类型与主角进程 ---
 目的：将宏观目标转化为具体、多样化的情节线，并规划主角的核心路径。
 要求：
  - 请根据输入的“分卷使命宣言”，为每一分卷严格按照下面的【分卷格式】生成内容。
  - 根据基础输入信息的总卷数与章节数，判断出是短篇还是长篇小说，情节线的复杂度与深度要匹配整体篇幅。

 【分卷内容示例】
● 第一卷
- 情节线：
  - `主线任务`：[1个推动故事主线发展的核心任务]
  - `重要支线/副本`：[2-3个用于丰富世界、塑造配角、调节节奏的次级情节]
  - `悬念线索`：[2-3个用于埋设伏笔、制造悬念的情节线]
  - 主角进程：[明确主角在本卷的起点状态 -> 核心经历 -> 终点状态（如何达成“成长节点”）]

- 情节线：...
 (以此类推)

 [最终输出格式]
 请严格按照以下格式生成内容，不要包含任何解释或注释。

◆ 模块三：情节线类型与主角进程
● 第一卷
- 情节线：
  - `主线任务`：[内容]
  - `重要支线/副本`：
    - [内容]
    - [内容]
  - `悬念线索`：
    - [内容]
    - [内容]
- 主角进程：[内容]

● 第二卷
- 情节线：...
... (以此类推)
"""

# --- 步骤四：核心角色塑造 ---
architecture_step4_character_prompt = """\
 AI角色：资深角色塑造师
 任务：在已经搭好的世界舞台和剧情“脊椎”上，设计出与这个故事完美契合的核心角色。

 [基础输入数据]
 - 类型：{genre}
 - 总卷数：{Total_volume_number}
 - 总章数（约）：{number_of_chapters}
 - 每章字数（约）：{word_number}
 - 核心主题：{topic}
 - 作者指导：{user_guidance}
 - 模块一、二、三 的生成结果：
{step1_result}
{step2_result}
{step3_result}

 [执行指令]
 --- 模块四：角色与核心驱动力 ---
 目的：创造与世界、情节深度绑定的角色，确保其所有行动都有坚实的内在逻辑。
 要求：请为主角团（主角+2-6名核心配角）生成档案：
   - 基本信息：姓名、性别、年龄、外貌、职业。
   - 角色背景：角色的背景故事，包括家庭、成长经历、重要事件等。
   - 核心驱动力：角色的主要目标、动机和内在冲突。
   - 出场规划：明确角色首次登场的分卷和关键事件（关联模块三的情节线），使其出场自带使命。
   - 根据基础输入信息的总卷数与章节数，判断出是短篇还是长篇小说，角色设计的复杂度与深度要匹配整体篇幅。

  输出格式：
  ◆ 模块四：角色与核心驱动力
主角：
【基本信息】
  - 姓名
  - 性别
  - 年龄
  - 外貌
  - 职业
【角色背景】 
  - 家庭
  - 成长经历
  - 重要事件
【核心驱动力】
  - 主要目标
  - 动机
  - 内在冲突
【出场规划】
  - 首次登场分卷
  - 关情节线节点

核心配角：
...（以此类推，直到所有核心角色）

 [输出要求]
 1. 严格遵循模块四的结构。
 2. 确保角色的设计服务于已有的世界观和情节。
 3. 仅输出最终文本，不要包含任何解释或注释。
 4. 必须严格使用 '◆模块四：角色与核心驱动力' 作为标题和分隔符，不要使用任何其他格式或Markdown标题。
"""

# --- 步骤五：叙事风格与体验设计 ---
architecture_step5_style_prompt = """\
 AI角色：叙事体验设计师
 任务：从读者的角度出发，为故事设计最终的“阅读体验”、艺术风格，并进行宏观章节布局。

 [基础输入数据]
 - 类型：{genre}
 - 总卷数：{Total_volume_number}
 - 总章数（约）：{number_of_chapters}
 - 每章字数（约）：{word_number}
 - 核心主题：{topic}
 - 作者指导：{user_guidance}
 - 模块一、二、三、四 的生成结果：
{step1_result}
{step2_result}
{step3_result}
{step4_result}

 [执行指令]
 --- 模块五：叙事风格与最终规划 ---
 目的：从艺术和读者的角度进行精加工，并为整个故事进行最终的宏观结构划分。
 要求：
  - 请根据已有的全部设定，严格按照下面的【分卷格式】完成以下最终规划。
  - 根据基础输入信息的总卷数与章节数，判断出是短篇还是长篇小说，章节分布与叙事风格的复杂度与深度要匹配整体篇幅。


 【分卷格式示例】
● 第一卷
- 章节分布：[例如：需严格按照基础数据内的总卷数、总章数，并参考所有上下文分析出章节分布，格式：第1章-第150章]
- 情绪基调：[例如：热血、悲壮、悬疑、温馨等]
- 叙事视角策略：[例如：主角限定视角、多角色POV、上帝视角]
- 标志性场景设计：[构思2-3个“名场面”]

● 第二卷
- 章节分布：...
 (以此类推)

 [最终输出格式]
 请严格按照以下格式生成内容，不要包含任何解释或注释。

◆ 模块五：叙事风格与最终规划
● 第一卷
- 章节分布：[内容]
- 情绪基调：[内容]
- 叙事视角策略：[内容]
- 标志性场景设计：[内容]

● 第二卷
- 章节分布：...
... (以此类推)
"""


# =============== 5. 章节目录与伏笔状态生成（分卷悬念节奏曲线）===================
chapter_blueprint_prompt = """\
作为专业作家，请根据以下元素：
【基础设定】
- 类型：{genre}
- 篇幅：共{Total_volume_number}卷，{number_of_chapters}章，每章{word_number}字
- 当前卷号：第{volume_number}卷
- 生成范围：第{x}章至第{y}章（需连续生成）

【内容指导】
{user_guidance}

【前3章章节大纲】
{chapter_list}

【最近出场的主要角色】
{main_character}

【分卷大纲】
{volume_outline}

【当前未回收伏笔状态】
{Foreshadowing_state}

【当前已有伏笔最大编号（如YF003→下个编号为YF004）】
{Foreshadowing_number}

【现在请设计第{x}章到第{y}章的章节大纲】
1. 章节构建规则：
- 叙事单元采用"起承转合"四章结构（可弹性伸缩±1章）
   每单元必须包含：
   主线推进事件（每单元至少1个）
   世界观揭示/伏笔埋设（每单元至少2个）
   角色发展弧光（每5-8单元出现重大转折）
- 新章节需满足：
   与前章存在物理空间/情感关系/事件因果三重关联
   每单元首章触发1个未回收伏笔
   末章必须回收1个到期伏笔
- 伏笔编号必须按对应的伏笔类型连续生成，不同类型单独计算，不可跳跃或空置。（YF001-YF002,MF001-MF002,...）
   生成伏笔前优先触发、强化、回收已有伏笔，再考虑是否生成新伏笔
   每单元末章必须回收1个到期伏笔
   未回收伏笔在当前生成章节范围必须设计回收
   结合主要角色状态进行章节大纲与伏笔的设计
   
2. 伏笔构建规则（严格遵循以下格式）：
   【类型定义】
   - MF（主线伏笔）：决定故事核心走向（如"王朝动荡""神器现世"）
     *回收章节 = 总章节数 × 0.2 (取整) | 回收要求：触发≥3连锁反应并闭环*
   - AF（暗线伏笔）："细思极恐"类世界观真相（如"古籍残页暗示轮回"）
     *回收章节 = 总章节数 × 0.4 (取整) | 回收要求：颠覆指数≥4级*
   - CF（人物伏笔）：角色背景/关系变化（如"主角左臂旧伤引发记忆闪回"）
     *回收章节 = 角色首次出场章节 + 30 | 回收要求：引发人物状态转变*
   - SF（支线伏笔）：次要剧情线发展（如"酒馆密谈暴露势力分布"）
     *回收章节 = 分卷总章数 × 0.3 (取整) | 回收要求：闭环解释并关联其他伏笔*
   - YF（一般伏笔）：场景级线索（如"客栈老板咳嗽声异常"）
     *回收章节 = 当前章节 + 5 | 回收要求：微观闭环（到期前2章强制回收）*

   【生命周期管理】
   - 过期检测：每次生成章节目录时，必须优先校验【当前未回收伏笔状态】
   - 在当前生成章节目录范围内必须回收的伏笔，需强制性安排回收章节
   - 其他不在回收范围内的伏笔，也许规划触发、强化等章节
   - 回收阈值：主线、暗线伏笔到期前5章触发回收 |  支线/人物伏笔前2章
   - 关联约束：每个新伏笔必须与2个以上现存未回收伏笔产生逻辑关联，形成网状结构
   - 状态标注：埋设/触发/强化/回收（禁止使用"悬置"等非标准状态）

3. 单章要素规范：
   - 情绪演变路径：期待→打破预期→重构认知（可自定义）
   - 章节名规则：需符合类型特征，且与章节内容高度相关，禁止在章节名中出现角色名、伏笔编号等元数据
   - 伏笔条目格式：
     ▶ 每章最多生成3个新伏笔（类型不可重复）
     ▶ 伏笔格式：CF001(人物伏笔)-标题-状态-伏笔简介（第X章前必须回收）
     ▶ 伏笔简介：人物/物品/...+场景/异常特征+主要内容/悬念指向（≤50字）

【输出模板】
第{x}章 [章节名]
├─本章定位：[对主线/支线/角色发展的具体贡献，例如：揭示主角过往的关键节点]
├─核心作用：[推动情节/揭示信息/塑造角色/渲染氛围，例如：通过一场对决，展现主角的新能力并激化与反派的矛盾]
├─叙事视角：[角色名]（第三人称限定/全知）
├─场景设定：
│├─时间：[具体时间，如“黄昏”，或相对时间，如“事件后三小时”]
│├─地点：[地点名称 + 关键环境特征，例如：废弃的钟楼，布满灰尘，唯一的月光从破窗照入]
│└─氛围：[整体基调，如“紧张”、“悬疑”、“温馨”]
├─出场角色与动机：
│├─[角色A]：[本章目标或初始状态，例如：寻找丢失的线索，情绪焦虑]
│├─[角色B]：[本章目标或初始状态，例如：试图阻止A，态度坚决]
│└─[其他角色]...
├─情节脉络（起-承-转-合）：
│├─起：[开端事件，引入冲突或情境。例如：A在钟楼下发现了B留下的神秘符号]
│├─承：[情节发展，冲突升级或信息展开。例如：A破解符号时，B突然出现并试图销毁它]
│├─转：[转折点，意外发生或关键决策。例如：争执中，符号装置被意外激活，投射出一段尘封的影像]
│└─合：[结局，本章事件的直接结果，留下悬念或过渡。例如：影像显示了一个惊人秘密，B在震惊中逃离，留下A独自面对新的谜团]
├─悬念类型：[信息差型/倒计时型/道德困境型...]
├─情绪演变：[例如：期待 → 错愕 → 坚定]
├─伏笔条目：
│├─CF001(人物伏笔)-血色胎记异变-触发-主角左臂胎记在暴雨夜发烫发光（第15章前必须回收）
│├─MF002(主线伏笔)-古籍预言应验-强化-客栈密谈提及"三日后的血月"（第20章前必须回收）
│└─YF003(一般伏笔)-哑仆异常举动-埋设-马厩老仆盯着马车轮毂喃喃自语（第6章前必须回收）
├─颠覆指数：Lv.X（颠覆源：[具体事件或信息]）
└─本章简述：[对“情节脉络”的高度概括，用于快速预览。例如：主角在钟楼追寻线索，与宿敌意外遭遇，并共同揭开了一段被遗忘的历史]

【执行要求】
- 使用中文
- 必须按章节顺序连续生成，禁止跳章
- 每叙事单元需达成分卷大纲的阶段性目标
- 悬念曲线需呈现波浪式递进（高潮章颠覆指数≥4）
- 禁止事项：
  ❌ 添加示例外文本
  ❌ 脱离大纲的即兴创作
  ❌ 混淆伏笔编号类型
  ❌ 遗漏到期伏笔回收
禁用Markdown，严格按照格式输出，仅返回内容文本，不要解释任何内容。
"""
# =============== 6. 前情摘要更新 ===================
summary_prompt = """\
请根据以下内容更新前情摘要：
以下是新完成的章节文本：
{chapter_text}

当前前情摘要（可为空）：
{global_summary}

◆ 信息提取要求：
1. 环境要素更新：
   - 场景转换记录（新增/变化的地点名称与特征）
   - 时间线推进（具体时间跨度或季节变化）
   - 势力分布变动（新增/消失的势力据点）

2. 核心事件整合：
   - 按时间顺序排列关键冲突及其结果
   - 人物状态变更（伤势/能力/身份变化）
   - 物品流转记录（关键道具获得/损失/异变）

3. 数据校验规则：
   - 自动过滤重复场景描写（保留首次完整描述）
   - 删除次要NPC无关细节（仅保留核心人物互动）
   - 字符数自动压缩至2000字内（优先保留战斗/转折/情报节点）

◆ 输出格式：
[时间线] 
当前时间坐标/季节/特殊天象（如暴雨/血月）

[地理图谱]
现存场景列表： 
场景A（特征：地形/建筑/异常现象） 
场景B（特征：...）

[势力分布]
现存势力： 
势力X（控制区域：地点A/B/C） 
势力Y（当前状态：扩张/收缩/内乱）

[人物状态快照]
核心人物： 
角色A（状态：健康/重伤/觉醒） 
角色B（持有物：物品X/Y/Z）

[事件脉络]（仅保留重要的节点）
按时间排序的事件链： 
1. 事件概述（触发条件→结果） 
2. 关键对话（"XXX"→引发XXX变化） 

[待解谜题]
未解决的核心矛盾： 
- 矛盾A（关联人物：角色X/Y） 
- 矛盾B（涉及物品：物品Z）

仅返回更新后的前情摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
# 7.1 角色状态格式
character_1_prompt = """\
请更新角色状态，严格按照以下权重等级生成对应字段：

◆ 权重等级定义（必须严格遵循）：
- [背景角色]（1-20）：仅生成【基础信息 + 位置轨迹】
- [单元角色]（21-40）：生成【基础信息 + 位置轨迹 + 势力特征】
- [次要配角]（41-60）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录】
- [关键角色]（61-80）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网】
- [核心配角]（81-95）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网 + 行为模式/决策偏好 + 语言风格/对话关键词】
- [主角级]（96-100）：生成所有字段

◆ 字段生成规则（必须严格执行）：
1. 权重≤20：禁止生成势力特征等高级字段
2. 权重≤40：禁止生成关键事件记录等字段
3. 权重≤60：禁止生成生命状态、持有物品字段
4. 权重≤80：禁止生成行为模式/决策偏好字段
5. 权重≤95：禁止生成情感线状态字段
6. 禁止生成当前权重未授权的任何字段

◆ 字段内容规范：
【基础信息】
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（精确数值+括号标注定位）
- 最后出场章节：第x章
- 禁用通用称谓：爸/妈/爹/大爷/阿姨等
【位置轨迹】
- 格式：场景名称-所在章节：第X章-事件：摘要-同行人物：某某-目的：某某
*生成数量：权重大于90的最多生成3条，其他权重角色只允许生成1条*
【势力特征】（仅当权重≥41时生成）
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...
【关键事件记录】（仅当权重≥21时生成）
- 格式：第X章：[类型] 事件摘要（如"第5章：[战斗] 峡谷遭遇伏击"）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【生命状态】（仅当权重≥41时生成）
- 身体状态：健康/特殊体质/伤势
- 心理状态：情绪基调/初期动机
- 长期影响：潜在问题/能力
【持有物品】（仅当权重≥41时生成）
- 格式：物品名称：（功能简述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【技术能力】（仅当权重≥41时生成）
- 格式：技能名称：（功能描述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【关系网】（仅当权重≥61时生成）
- 格式：角色名:关系类型,关系强度[低/中/高],互动频率[稀少/普通/频繁]
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【行为模式/决策偏好】（仅当权重≥81时生成）
- 行为模式：≤10字描述
- 决策偏好：优先级排序（如"自保>探索>结盟"）
【语言风格/对话关键词】（仅当权重≥81时生成）
- 语言风格：≤2个关键词
- 关键词：≤3条常用短句
【情感线状态】（仅当权重≥96时生成）
- 情感线状态：起点阶段描述
- 感情进展标记：【好感度：XX%】【羁绊等级：X】

◆ 角色状态生成：
- 生成的角色编号必须严格按照输出要求格式与“检索出的角色与对应编号”的内容对应生成，如：（编号：角色名称）为（ID0003：苏月璃），顺序不能颠倒，编号不能重复，也不能直接使用"编号"两字代替。
- 角色编号按照检索出的角色对应编号填写至格式内对应角色编号内。
- 其他称谓不要出现：父亲、母亲等通用称谓。
- 权重随着章节推进，权重会逐渐提升或者下降，角色状态会逐渐丰富。

◆ 输出要求：
- 完全禁用当前权重未授权的字段
- 每个字段之间禁止出现空行
- 字段内容为空时返回空值
- 禁止解释/注释/额外文本
- 严格遵循权重等级生成对应数量的条目
- 严格遵循以下格式：

格式：
编号：角色名称
基础信息：
- 其他称谓：...
- 角色权重：...
- 最后出场章节：...
位置轨迹：
- 场景名称-所在章节：第X章-事件：摘要-同行人物：某某-目的：某某
势力特征：
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等）
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...

（根据权重生成后续字段...）

示例：
ID0003：苏月璃
基础信息：
- 其他称谓：...
- 角色权重：85（核心配角）
- 最后出场章节：第2章
位置轨迹：
- 图书馆-所在章节：第2章-事件：调查案件-同行人物：周老寨主/雷军师-目的：收集信息
势力特征：
- 势力归属：
  籍贯/家乡：联邦·蔚蓝星·北境·霜雪岭
  所属势力：第三军团·海神要塞·歼星舰 “流浪者”号
- 身份定位： 联邦巡逻舰舰长
- 外貌特征： 未描述（仅声音）
- 性格关键词： 沉稳、专业、谨慎、果断

（根据权重生成后续字段...）

---

ID0004：xxx

---
"""

# 7.1.1 生成当前分卷大纲提示词的角色状态
create_character_state_prompt = """\
基于以下元素：
当前小说为{genre}小说共{volume_count}卷，共{num_chapters}章，每章{word_number}字
准备生成小说第{volume_number}卷需要的角色状态
【小说主题】
{topic}

【内容指导】
{user_guidance}

【小说设定】
{novel_setting}

【分卷大纲】
{volume_outline}

【角色状态格式】

◆ 权重等级定义（必须严格遵循）：
- [背景角色]（1-20）：仅生成【基础信息 + 位置轨迹】
- [单元角色]（21-40）：生成【基础信息 + 位置轨迹 + 势力特征】
- [次要配角]（41-60）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录】
- [关键角色]（61-80）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网】
- [核心配角]（81-95）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网 + 行为模式/决策偏好 + 语言风格/对话关键词】
- [主角级]（96-100）：生成所有字段

◆ 字段生成规则（必须严格执行）：
1. 权重≤20：禁止生成势力特征等高级字段
2. 权重≤40：禁止生成关键事件记录等字段
3. 权重≤60：禁止生成生命状态、持有物品字段
4. 权重≤80：禁止生成行为模式/决策偏好字段
5. 权重≤95：禁止生成情感线状态字段
6. 禁止生成当前权重未授权的任何字段

◆ 字段内容规范：
【基础信息】
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（精确数值+括号标注定位）
- 最后出场章节：第x章
- 禁用通用称谓：爸/妈/爹/大爷/阿姨等
【位置轨迹】
- 格式：场景名称-所在章节：第X章-事件：摘要-同行人物：某某-目的：某某
*生成数量：权重大于90的最多生成3条，其他权重角色只允许生成1条*
【势力特征】（仅当权重≥41时生成）
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...
【关键事件记录】（仅当权重≥21时生成）
- 格式：第X章：[类型] 事件摘要（如"第5章：[战斗] 峡谷遭遇伏击"）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【生命状态】（仅当权重≥41时生成）
- 身体状态：健康/特殊体质/伤势
- 心理状态：情绪基调/初期动机
- 长期影响：潜在问题/能力
【持有物品】（仅当权重≥41时生成）
- 格式：物品名称：（功能简述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【技术能力】（仅当权重≥41时生成）
- 格式：技能名称：（功能描述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【关系网】（仅当权重≥61时生成）
- 格式：角色名:关系类型,关系强度[低/中/高],互动频率[稀少/普通/频繁]
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【行为模式/决策偏好】（仅当权重≥81时生成）
- 行为模式：≤10字描述
- 决策偏好：优先级排序（如"自保>探索>结盟"）
【语言风格/对话关键词】（仅当权重≥81时生成）
- 语言风格：≤2个关键词
- 关键词：≤3条常用短句
【情感线状态】（仅当权重≥96时生成）
- 情感线状态：起点阶段描述
- 感情进展标记：【好感度：XX%】【羁绊等级：X】

◆ 角色状态生成：
- 其他称谓不要出现：父亲、母亲等通用称谓。
- 权重随着章节推进，权重会逐渐提升或者下降，角色状态会逐渐丰富。

◆ 输出要求：
- 完全禁用当前权重未授权的字段
- 每个字段之间禁止出现空行
- 字段内容为空时返回空值
- 禁止解释/注释/额外文本
- 严格遵循权重等级生成对应数量的条目
- 严格遵循以下格式：

格式：
角色名称
基础信息：
- 其他称谓：...
- 角色权重：...
- 最后出场章节：...
位置轨迹：
- 场景名称-所在章节：第X章-事件：摘要-同行人物：某某-目的：某某
势力特征：
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等）
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...

（根据权重生成后续字段...）

示例：
苏月璃
基础信息：
- 其他称谓：...
- 角色权重：85（核心配角）
- 最后出场章节：第2章
位置轨迹：
- 图书馆-所在章节：第2章-事件：调查案件-同行人物：周老寨主/雷军师-目的：收集信息
势力特征：
- 势力归属：
  籍贯/家乡：联邦·蔚蓝星·北境·霜雪岭
  所属势力：第三军团·海神要塞·歼星舰 “流浪者”号
- 身份定位： 联邦巡逻舰舰长
- 外貌特征： 未描述（仅声音）
- 性格关键词： 沉稳、专业、谨慎、果断

（根据权重生成后续字段...）

要求：
- 不要生成与小说主题无关的角色
- 不要生成提示词里已有的角色
- 生成的角色状态必须符合提示词要求
除了提示词内已有的角色外，按照提示词再帮我生成第{volume_number}卷会用到的{num_characters}个主要角色
请根据上述要求，生成角色状态文档。

"""
# 7.1.2 生成小说后续章节草稿正文时角色状态
create_character_prompt = """\
基于以下元素：
【章节基本信息】
当前小说为{genre}小说共{volume_count}卷，共{num_chapters}章
准备生成小说第{volume_number}卷 第{novel_number}章《{chapter_title}》 字数：{word_number}字

【当前章节目录】
{chapter_blueprint_content}

【小说主题】
{topic}

【内容指导】
{user_guidance}

【前情摘要】
{global_summary}

【上一章剧情要点】
{plot_points}

【分卷大纲】
{volume_outline}

【角色数据库】
{Character_Database}

1、按照上面所有内容设定，从角色数据库中提取出本章正文会使用到的角色ID编号。
2、再根据设定，生成本章需要用到新角色，按照格式生成新角色。
3、角色数据库为空时，无需生成角色ID，直接生成新角色。

◆ 要求：
- 角色数据库为空时，无需生成角色ID编号
- 不要提取与本章正文无关的角色的角色ID编号
- 仅提取符合设定要求的角色ID编号
- 提取角色数据库内的角色，只需要角色ID编号，不要生成该角色的其他信息
- 如果需要新角色，基于上述所有设定（章节信息、小说主题、内容指导、前情摘要、剧情要点、分卷大纲、角色数据库）按照“新生成角色格式”完整生成。
- 仅提及不会出场的角色信息尽量简洁，并在条目中注明
- 没有出场并不会提及的角色不要生成
- 不要生成重复的角色ID编号
- 新角色生成时不要与角色数据库内已有的角色重复
- 根据设定，需要生成新角色的，需按照新角色格式生成
- 根据设定，生成角色基础信息，不要出现超出当前章节设定的角色基本信息
- 不要添加任何介绍性文本、标题或章节信息，直接从角色ID开始
- 确保每个角色之间有明确的分隔，不要将一个角色的信息与另一个角色的ID混在一起

◆ 新生成角色格式为：（不允许生成数据库内已有角色）
角色名：
基础信息：
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（1-20背景角色，21-40单元角色，41-60次要配角，61-80关键角色，81-95核心配角，96-100主角级）
势力特征：
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等）
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...
基本简介：50字以内
示例：
林夏：
基础信息：
- 其他称谓：小夏（亲友用）、阿Lin（别称，同事称呼）、林姐（尊称，下属称呼）、沈安（化名，隐藏身份时使用）
- 角色权重：82（定位：核心配角）
势力特征：
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等）
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...
基本简介：50字以内


◆ 返回内容格式

提取角色ID编号：
ID0001
ID0005

新生成角色：

新角色格式

---
请根据上述要求，生成角色状态文档.
"""

# 7.2 角色名称提取提示词
Character_name_prompt = """\
你是一位专业的文本分析专家，请仔细阅读以下章节内容，提取出所有出现的角色名称。

当前章节：第{novel_number}章 《{chapter_title}》

【角色数据库】
{Character_Database}

【章节内容】
{chapter_text}

【任务说明】

- 从章节中提取所有具有独立身份或智慧特征的角色（包括人类、妖魔、神灵、异兽、精怪、法宝化身等），
- 并根据已有角色数据库进行比对与更新。对于新发现的角色，需为其分配唯一ID并建立基础档案；对于已知角色，应根据本章信息补充或修正其正式名及各类称谓。
- 严格判断角色名称，确保不要把数据库已有角色判断为新角色。
- 不能区分角色的称谓需添加明确标识以便区分（如“某人父亲”、“偷香囊的乞丐”、“卖花小女孩”），不许出现“姐姐”、“长官”、“小二”等不明确的称谓、职位等名称

【提取原则】
1. 角色定义范围
- 主角、配角、路人甲等人类角色
- 妖魔、神灵、异兽、精怪、鬼魂、植物精魄等非人类智慧生物
- 有个性、有名字的主要宠物、坐骑、法宝化身等
- 具备人格化设定的自然现象（如“风伯”、“雷公”）
- 统称需以姓名、环境、事件等信息结合方式命名（如“某人父亲”、“偷香囊的乞丐”）

2. 仅提取明确角色名称
- 不提取代词（如“他”、“她”、“他们”）、泛指词汇（如“众人”、“一个黑影”）等模糊表达
- 对亲属称谓、职位、别称等非姓名类统称的，必须带有姓氏、势力、环境、事件等便于区分的信息（如“某人父亲”、“偷香囊的乞丐”），

3. 角色名称匹配与更新
- 同一角色使用多个称呼时，需判断是否为同一角色，并统一使用数据库中已有的ID及最新正式名
- 若某角色在本章首次出现全名，则将该全名设为正式名，原非全名称谓归入【其他称谓】。
- 同一角色若多次出现不同称呼，统一使用数据库中已有ID及最新正式名。

4. 其他称谓处理
- 能明显区分的角色名称（如“钱塘江巨龙”、“跛脚乞丐”）可提取为角色名，但需确保其具备独立身份特征
- 能明确区分角色的称谓（如“玄门长老”、“九幽蛇君”、“醉花楼小二”）可提取为角色名，但需确保其具备独立身份特征
- 不能区分角色信息的称谓（如“老者”、“小二”、“少年”等）又无其他信息辅助区分的角色不提取
- 

 5. 角色称谓分类规范
对同一角色的不同称呼，按以下分类整理：
- 正式名：官方认定或首次完整出现的名字
- 别称：他人给予的昵称、绰号、尊称等
- 小名/乳名：亲友间使用的亲昵称呼
- 尊称：带有敬意的称呼（如“前辈”、“仙师”）
- 化名：隐藏身份时使用的假名
- 职位/职务：以其职位命名的称呼（如“李县令”）

【输出要求】

1. 输出格式

ID0001：张三（别称：无极子；尊称：张真人；职位：玄门长老）
ID0002：李德全（别称：李县令；职位：和田县令）
ID0003：王氏（周明母亲）
ID0004：周父（周明之父）
ID0005：青鳞妖王（尊称：九幽蛇君）
ID0006：白泽（别称：通晓兽；尊称：灵兽尊者）


2. 排序规则
- 按角色在本章中的出场顺序与重要程度综合排序
- 同一角色若多次出现不同称呼，仅保留一次完整条目（合并称谓）

---

请直接输出角色名称列表，不要有任何额外说明。
"""

# 7.3 定稿时的角色状态更新
update_character_state_prompt = """\
【任务：更新角色状态】
你是一个资深的小说编辑，你的任务是根据最新的章节内容，更新角色状态数据库。请严格按照Markdown格式输出结果。

【章节基本信息】
- 小说类型：{genre}
- 总卷数：{volume_count}
- 总章数：{num_chapters}
- 当前卷：第{volume_number}卷
- 当前章：第{novel_number}章《{chapter_title}》

【章节文本】
---
{chapter_text}
---

【需要更新的角色列表】
{Character_Database}

【这些角色的旧状态（Markdown格式）】
---
{old_state}
---

【更新规则与输出格式】
1.  **仔细阅读**：请仔细阅读【章节文本】，分析【需要更新的角色列表】中每个角色的行为、状态变化、位置移动等。
2.  **在旧状态上更新**：以【这些角色的旧状态】为基础，根据本章发生的新事件进行修改和补充。
3.  **严格遵循格式**：你的输出必须严格遵循【角色状态格式】。这是最重要的规则。
4.  **返回完整状态**：对于每个被更新的角色，你必须返回其完整的、所有字段的状态，而不仅仅是发生变化的字段。
5.  **无变化则照搬**：如果一个角色的状态在本章没有任何变化，请原样输出其【旧状态】。
6.  **禁止额外内容**：不要添加任何解释、注释或“更新说明”之类的额外文本。

---
请更新角色状态，严格按照以下权重等级生成对应字段：

◆ 权重等级定义（必须严格遵循）：
- [背景角色]（1-20）：仅生成【基础信息 + 位置轨迹】
- [单元角色]（21-40）：生成【基础信息 + 位置轨迹 + 势力特征】
- [次要配角]（41-60）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录】
- [关键角色]（61-80）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网】
- [核心配角]（81-95）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网 + 行为模式/决策偏好 + 语言风格/对话关键词】
- [主角级]（96-100）：生成所有字段

◆ 字段生成规则（必须严格执行）：
1. 权重≤20：禁止生成势力特征等高级字段
2. 权重≤40：禁止生成关键事件记录等字段
3. 权重≤60：禁止生成生命状态、持有物品字段
4. 权重≤80：禁止生成行为模式/决策偏好字段
5. 权重≤95：禁止生成情感线状态字段
6. 禁止生成当前权重未授权的任何字段

◆ 字段内容规范：
【基础信息】
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（精确数值+括号标注定位）
- 最后出场章节：第{novel_number}章
- 禁用通用称谓：爸/妈/爹/大爷/阿姨等
【位置轨迹】
- 格式：场景名称-所在章节：第{novel_number}章-事件：摘要-同行人物：某某-目的：某某
*生成数量：权重大于90的最多生成3条，其他权重角色只允许生成1条*
【势力特征】（仅当权重≥41时生成）
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...
【关键事件记录】（仅当权重≥21时生成）
- 格式：第{novel_number}章：[类型] 事件摘要（如"第5章：[战斗] 峡谷遭遇伏击"）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【生命状态】（仅当权重≥41时生成）
- 身体状态：健康/特殊体质/伤势
- 心理状态：情绪基调/初期动机
- 长期影响：潜在问题/能力
【持有物品】（仅当权重≥41时生成）
- 格式：物品名称：（功能简述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【技术能力】（仅当权重≥41时生成）
- 格式：技能名称：（功能描述）
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【关系网】（仅当权重≥61时生成）
- 格式：角色名:关系类型,关系强度[低/中/高],互动频率[稀少/普通/频繁]
*生成数量：权重大于90的最多生成5条，其他权重角色只允许生成2条*
【行为模式/决策偏好】（仅当权重≥81时生成）
- 行为模式：≤10字描述
- 决策偏好：优先级排序（如"自保>探索>结盟"）
【语言风格/对话关键词】（仅当权重≥81时生成）
- 语言风格：≤2个关键词
- 关键词：≤3条常用短句
【情感线状态】（仅当权重≥96时生成）
- 情感线状态：起点阶段描述
- 感情进展标记：【好感度：XX%】【羁绊等级：X】

◆ 角色状态生成：
- 生成的角色编号必须严格按照输出要求格式与“检索出的角色与对应编号”的内容对应生成，如：（编号：角色名称）为（ID0003：苏月璃），顺序不能颠倒，编号不能重复，也不能直接使用"编号"两字代替。
- 角色编号按照检索出的角色对应编号填写至格式内对应角色编号内。
- 其他称谓不要出现：父亲、母亲等通用称谓。
- 权重随着章节推进，权重会逐渐提升或者下降，角色状态会逐渐丰富。

◆ 输出要求：
- 完全禁用当前权重未授权的字段
- 每个字段之间禁止出现空行
- 字段内容为空时返回空值
- 禁止解释/注释/额外文本
- 严格遵循权重等级生成对应数量的条目
- 严格遵循以下格式：

格式：
编号：角色名称
基础信息：
- 其他称谓：...
- 角色权重：...
- 最后出场章节：...
位置轨迹：
- 场景名称-所在章节：第X章-事件：摘要-同行人物：某某-目的：某某
势力特征：
- 势力归属：
  籍贯/家乡：国家·地区·村庄（种族/国家/地区）
  所属势力：学校·班级（组织/公司/单位/帮派等）
- 身份定位： XXX（职业/身份描述）
- 外貌特征： XXX（≤20字简要描述）
- 性格关键词： 关键词1、关键词2、关键词3、...

（根据权重生成后续字段...）
---

示例：
ID0003：苏月璃
基础信息：
- 其他称谓：...
- 角色权重：85（核心配角）
- 最后出场章节：第2章
位置轨迹：
- 图书馆-所在章节：第2章-事件：调查案件-同行人物：周老寨主/雷军师-目的：收集信息
势力特征：
- 势力归属：
  籍贯/家乡：联邦·蔚蓝星·北境·霜雪岭
  所属势力：第三军团·海神要塞·歼星舰 “流浪者”号
- 身份定位： 联邦巡逻舰舰长
- 外貌特征： 未描述（仅声音）
- 性格关键词： 沉稳、专业、谨慎、果断

（根据权重生成后续字段...）
---

ID0004：xxx
"""

# =============== 8. 章节正文草稿写作 ===================
chapter_draft_prompt = """
【历史章节正文】
{历史章节正文}

【小说基本信息】
小说类型：{genre}
小说主题：{topic}
章节编号：第 {novel_number} 章《{chapter_title}》
目标字数：约 {word_number} 字

【用户额外指导】
关键物品：{key_items}
场景位置：{scene_location}
时间约束：{time_constraint}
用户需求：{user_guidance}

【故事框架】
当前章节目录：{current_chapter_blueprint}
下一章章节目录：{next_chapter_blueprint}
分卷大纲：{volume_outline}
前情摘要：{global_summary}
上一章剧情要点：{plot_points}

【角色与伏笔】
角色状态：{setting_characters}
伏笔历史记录：{knowledge_context}

 AI角色设定：文学创作者与AI文本优化专家

请你扮演一位经验丰富的文学创作者与AI文本优化专家。你的任务是运用你敏锐的洞察力和专业的写作技巧，创作出一篇如同人类资深作家亲笔的章节草稿，使其自然、生动、并充满情感深度和文学美感。

---

 核心目标：“去AI味”，提升文学质感
- “生成内容必须符合中文语言习惯，避免出现任何不符合中文表达的句式和用词。”
- “禁止生成任何AI常用的套话、模板化表达和机械式叙述。”
- “禁止使用过多形容词，无病呻吟。”
- “生成内容禁止出现语法错误、拼写错误和标点符号使用不当之处。”
- “请优化句子结构，使其更自然流畅，避免冗长、累赘或表意不清的句子。”
- “禁止生成平淡或不准确的词汇，使用更精准、生动、形象的词语。”
- “请确保用词和句式符合目标读者的语言习惯和理解水平。”
- “消除歧义，确保每个句子和段落的含义清晰明确。”
- “调整语序，使句子读起来更符合中文表达习惯。”
- “检查并修正可能存在的生硬翻译痕迹，使其更地道。”
- “删除重复信息和不必要的修饰，使文章更精炼。”
- 禁止生成"仿佛"|"像"|"像是"|"似的"|"似乎在"|"心中充满了"|"构成了"等AI常用词语。

 一、首要任务：精准的字数控制与内容生成

【绝对核心指令：严格控制输出字数】
- 最终字数要求：必须严格控制在 {字数下限} 字至 {字数上限} 字的范围之内。
- 这是一个强制性指令，是本次任务最重要的评判标准。
- 为了达成这个目标，你必须对每一个情节、每一次对话、每一段心理活动和场景描写都进行细致、详尽的扩写，绝不允许简写或跳过。
- 充分利用你的想象力，丰富每一个细节，确保内容饱满，最终达到字数目标。
- 绝不允许最终字数超出 [ {字数下限} - {字数上限} ] 这个区间。

 **叙事逻辑强化**
- **章节锚点**：
   - 对于非跳跃章节：必须严格基于前一章的[剧情要点]结尾触发点（场景残留/时间标记/事件余波）展开，确保无缝衔接。
   - 对于跳跃章节：需通过以下方式构建逻辑桥梁：
     - 时间跳跃 → 引入时间线索（如日记、回忆闪回、年龄变化、季节更替）
     - 空间跳跃 → 借助交通工具、传送机制、梦境/幻觉等自然过渡手段
     - 视角跳跃 → 通过对话、旁白、信件、监控记录等方式建立连接
     - 因果跳跃 → 以悬念式开头引发疑问，随后逐步揭示原因
     - 世界观跳跃 → 使用"认知冲击"或"现实扭曲"作为转场契机（如穿越、觉醒、意识投射）
- **节奏控制**：根据悬念类型和颠覆指数设计情节密度，例如：  
  - 信息差型：通过角色视角的局限性制造认知偏差  
  - 道德抉择型：用角色价值观冲突推动剧情  
  - 倒计时型：插入时间紧迫感的细节（如沙漏、心跳声、天象变化）  
  - 谜题型：通过环境线索（如壁画符号、对话暗示）逐步揭示真相

**角色行为可信度**  
- **动机优先**：角色的所有行动必须与其[角色状态]中的决策偏好、情感线状态和长期影响一致，例如：  
  - 主角在情绪崩溃后不会突然冷静分析，需通过生理反应（颤抖、口吃）过渡  
  - 拥有"童年创伤"的角色在压力下会触发特定防御机制（如逃避/攻击）  
- **对话设计**：  
  - 每个角色的台词需符合其语言风格和关键词（如"闭嘴""别小看我"）  
  - 关键对话必须推动关系网变化（信任→怀疑/合作→背叛）
  
**特别注意事项**
1. **避免AI痕迹**：
   - 像真人聊天：多用“你/我”，少用“用户/系统”。
   - 禁止无脑使用他/她/他们，直接使用称谓名字或直接省略掉他、他的；如：“他的话音落下”，写成：“话音落下”；“他甚至没有抬眼去看那个汇报的长老”，写成：“甚至没有抬眼去看那个汇报的长老”
   - 避免过度使用“然而”、“因此”、“综上所述”等逻辑连接词。
   - 使用自然流畅的语言，避免机械式句式或重复结构
   - 章节内容应具有文学性和代入感，减少生硬的描述
   - 对话要贴近真实人物性格，避免过于刻板或模式化
  **语言自然化与生活化**：
   - 摒弃工整排比句、过度书面语和教科书式说明。
   - 生成的内容每一段禁止使用相似的开头或内容，如“他的意识模糊不清”，“他努力地睁开眼睛”。
   - 融入生活化细节（如人物下意识的动作、环境中的瑕疵、不完美的反应）。
   - 大量运用口语化表达、特定角色的口头禅、地域方言（若适用）、语气词（啊、呢、吧、哼）以及符合情境的粗口或俚语。
   - 描写中融入不完美、冗余和略带主观色彩的细节（如“阳光刺得他眯起眼，墙角有块剥落的墙皮”而非“阳光明媚，墙壁洁白”）。
   - 避免使用“然而”、“因此”、“综上所述”等逻辑连接词过度串联，多用动作、神态、环境变化自然过渡。
   - 说人话！ 像平常聊天那样，多用“啧”、“那什么”、“就...”。可以说“简单点说！”、“别整太复杂！”。
   - 少点套路： “综上所述”、“值得注意的是”、“本质上”这种AI专用过渡词，一个都别用。
   - 别掉书袋： 技术解释绕道走，讲清楚就行，别搞复杂。
   - 废话少说： 别加没用的比喻（特别是“仿佛”、“如同”、“似的”开头的）、数字、细节（比如衣服啥颜色、手指怎么动、声音像啥、人物啥微表情/动作）。
   - 别端着： 句子别又长又绕，结构简单点。别用“宏大”但空洞的词。
   - 别硬解释： 因果关系点到为止，别没完没了分析。
   - 情绪连着身体： 写人物情绪时，带上点身体反应（但别写“深吸一口气”、“眼神坚定”这种具体被禁的），别光秃秃写“他高兴”或“她害怕”。
   - 转场自然点： 别老用“然后”、“接着”、“与此同时”这种词硬转。
   - 别列清单： 1、2、3分点走开，有话用段落连着说。
2. **遵循大纲**：严格按照[分卷大纲]中对本卷及本章的规划（如主题、情节发展、角色任务等）进行创作，确保故事主线不偏离。
3. **角色塑造**：参考[角色状态]中各角色的性格、目标、当前状态和关系网等内容，确保角色言行符合其设定，并通过本章情节推动角色成长或展现其多面性。
4. **世界观一致**：创作时必须严格遵守世界观规则，包括物理法则、社会结构、文化背景等。
5. **情节推进**：本章需完成章节信息中设定的核心作用（如推进主线、制造转折、揭示世界观等）。
6. **用户指导优先**：如果用户额外指导中的内容与上述要点有冲突，优先遵循用户额外指导。
7. **伏笔处理**：按照伏笔条目的内容要求有效埋设、触发、强化或回收伏笔，并衔接对应的伏笔历史记录。
8. **下一章衔接**：结合本章内容在章节结尾处，适当引入下一章的线索或悬念，为后续情节做好铺垫，检查下一章场景设定，如果下一章为跳跃章节，则需在结尾处自然引入时间或空间的跳跃线索。
9. **下一章规避**：禁止在本章内容中直接提及与下一章相关的具体情节或事件，避免后续章节内容重复与冲突

**叙事连贯性**
- **前文衔接**：
   - 必须与前情摘要和上一章剧情要点形成有效衔接
   - 必须继承前一章的环境锚点和结尾触发点
   - 确保冲突演进合理延续前章矛盾主线

**叙事技巧**
- **情节节奏**：
   - 章节起承转合流畅
   - 场景过渡自然
   - 情节铺垫充足
   - 冲突升级合理
   - 高潮设置恰当
   
- **环境描写**：
   - 场景细节丰富
   - 氛围营造到位
   - 季节/时间标识清晰
   - 空间关系明确
   - 场景与情节呼应
   - 避免过于完美/理想化的场景

- **人物刻画**：
   - 性格特征鲜明
   - 心理活动合理
   - 动作描写生动
   - 外貌特征突出
   - 人物关系立体
   - 避免角色过于完美无缺
   - 避免角色行为过于理性/机械

- **对话设计**：
   - 对话符合人设和语言风格
   - 语气语调自然
   - 交谈节奏合适
   - 对话目的明确
   - 潜台词恰当
   - 避免对话过于工整/规范
   - 保持口语化特征

【内容要求】
1. **叙事真实性**：
    - 避免过度完美的情节安排
    - 避免过于理性的角色反应
    - 避免机械化的对话模式
    - 避免标准化的句式结构
    - 增加生活化细节描写
    - 增加叙事的不确定性
    - 增加人性化反应
    - 适当打破完美逻辑

2. **文学性要求**：
    - 主题表达深刻
    - 意境营造成功
    - 情感表达真实
    - 文字表达优美
    - 突出审美价值
    - 避免过于理想化的情节发展
    - 避免缺乏人性温度的叙事

3. **逻辑要求**：
    - 情节发展符合世界观设定
    - 角色行为符合人设
    - 伏笔处理合理且富有张力
    - 确保与历史伏笔记录保持一致
    - 遵循分卷大纲的章节功能定位

4. **技术规范**：
    - 避免伏笔编号、角色编号等元数据标记
    - 避免内心独白等机械化描写
    - 使用自然流畅的语言
    - 保持对话的个性化
    - 避免重复的描写模式

5. **章节衔接**：
    - 本章结尾为下章做好铺垫
    - 悬念设置与下章自然衔接
    - 情绪演变为下章做好准备
    - 避免透露下章具体情节
---

 四、输出要求

- 最终交付：仅返回经过你精心创作的章节正文。
- 格式规范：输出纯净的文本，使用中文全角标点符号，段落之间不允许出现空行。
- 禁止事项：禁止输出任何解释、注释、Markdown标记或故事框架中不存在的元数据（如角色编号、伏笔编号等）。

现在，开始你的创作。
"""

# 8.1 伏笔历史记录提取预处理
chapter_draft_knowledge_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_ids}
分析出本章伏笔编号,单独使用伏笔编号作为提示词从向量库检索出伏笔历史内容
  - 伏笔历史内容（从向量库检索）：

格式示例如下：
YF001:
内容：整合后的最新内容1
伏笔最后章节：第{novel_number}章

CF001:
内容：整合后的最新内容2
伏笔最后章节：第{novel_number}章
  
◆ 输出要求：
  - 仅返回最终用于向量化的JSON格式数据。
  - 不要包含任何解释或额外文本。
  - 如果没有相关伏笔内容，返回本章伏笔无历史内容。
"""
# =============== 9. 知识提取、整合与向量化 ===================

# 9.1 伏笔内容提取、整合与向量化提示词
foreshadowing_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》

  - 伏笔历史内容（从向量库检索）：
{foreshadowing_history} 
  
  - 本章伏笔内容（已预处理）：
{current_foreshadowing_content}

◆ 处理流程：

  1. 整合内容：
     - 使用LLM整合所有内容，输出格式为普通文本。
     - 整合【伏笔历史内容】 和【本章伏笔内容】，要求内容完整不可缺失，后期可通过整合内容全秒了解伏笔的所有信息 。
     - 对每个伏笔编号，生成整合后的最新伏笔描述。
     - 考虑伏笔状态（埋设/触发/强化/回收），确保内容连贯。
     - 最后使用嵌入模型将内容向量化。

  2. 输出与向量化准备：
     - 输出整合后的伏笔内容。
     - 输出格式（用于后续向量化，需严格遵守）：

YF001:
内容：整合后的最新内容1
伏笔最后章节：第{novel_number}章

CF001:
内容：整合后的最新内容2
伏笔最后章节：第{novel_number}章
...
- 重要: `内容` 字段应包含伏笔的详细描述或最新进展。`伏笔最后章节` 字段必须包含该伏笔最后出现的章节编号。

◆ 输出要求：
  - 仅返回最终用于向量化的普通文本格式数据。
  - 不要包含任何解释或额外文本。
"""


#  9.2 剧情要点提取
plot_points_extraction_prompt = """\
【章节剧情要点任务】

◆ 输入数据：
准备生成小说第{novel_number}章的剧情要点
【当前章节目录】
{current_chapter_blueprint}

【前情摘要】
{global_summary}

【上一章剧情要点】
{plot_points}

【本章章节正文】
{chapter_text}

◆ 解构维度：
环境锚点：
- 主场景：精确到具体建筑/地形特征（如"断崖边的废弃古庙"）
- 氛围要素：天气/光照/特殊现象（如"血色月光笼罩"）
- 时间刻度：具体时辰/季节特征（如"霜降前夜"）
- 场景细节：场景内标志性陈设/地理标识（如"石阶上布满青苔"）
冲突节点（按优先级排序）：
- 主冲突：对抗双方+冲突本质（如"正邪两派争夺上古秘宝"）
- 次冲突：人物间立场/利益碰撞（如"师徒理念分歧爆发"）
- 潜冲突：埋设的潜在矛盾线索（如"体内异火出现反噬征兆"）
状态变更：
- 角色状态：重要角色生死/伤势/能力变化（带章节依据）
- 物品状态：关键道具所有权/完整性变更（如"玄铁剑断裂"）
- 关系状态：人物关系突破性进展（如"盟友→叛徒"）
- 情绪状态：角色情感转折（如"从愤怒转为冷静谋划"）
推进力度：
- 时间推进：本章引发的时间跨度（如"三日后决战将至"）
- 空间坐标：场景转移距离（如"从北境雪原跨越至火山腹地"）
- 矛盾升级：冲突烈度变化等级（如"言语交锋→生死对决"）
- 节奏倾向：高潮收尾/悬而未决/伏笔暗藏
【章节结尾触发点】（用于下一章开头响应）
- 场景残留：章末最后一幕的具体画面（如"古庙废墟中，主角跪地咳血"）
- 时间标记：章末时间节点或时间跳跃提示（如"子时钟声响起，封印松动"）
- 事件余波：本章结尾引发的直接后果（如"异火失控灼烧同伴，众人哗变"）


◆ 输出格式：
第{novel_number}章《{chapter_title}》剧情要点：
【环境锚点】
- 主场景：XXX（精确描述）
- 氛围特征：XXX（视觉/听觉/气候）
- 时间坐标：XXX（具体时段标记）
- 场景细节：XXX
【冲突演进】
- 主冲突：XXX ←→ XXX（矛盾本质）
- 次冲突：XXX 与 XXX（冲突类型）
- 潜冲突：XXX（暗示性线索）

【状态变更】
- 角色层：XXX（状态变化依据）
- 物品层：XXX（变更细节）
- 关系层：XXX（关系转变）
- 情绪层：XXX（情感转折）
【推进指标】
- 时间跨度：+XX日/月/年
- 空间坐标：XX里（具体距离）
- 矛盾烈度：言语交锋→生死对决（Lv.X→Lv.X+1）
- 节奏倾向：高潮/伏笔/转折
【章节结尾触发点】
- 场景残留：XXX（最后一幕画面）
- 时间标记：XXX（时间节点）
- 事件余波：XXX（直接后果）

禁止使用任何格式符号，各模块间用空行分隔，不要添加解释说明。
"""

# 9.3 伏笔历史内容预处理
foreshadowing_history_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_ids}

分析出本章伏笔编号,单独使用伏笔编号作为提示词从伏笔状态.md文件提取出伏笔历史内容
  - 伏笔历史内容：

◆ 输出要求：
  - 请按以下格式输出每个伏笔的历史内容：

YF001:
历史内容：伏笔1的历史内容

CF001:
历史内容：伏笔2的历史内容

...

  - 如果没有历史内容，请注明"无历史内容"
  - 不要包含任何解释或额外文本。
"""

# 9.4 本章伏笔内容的预处理
foreshadowing_content_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_entries}


【章节正文】
{chapter_text}

请仔细阅读【章节正文】，为【本章涉及伏笔编号列表】中的每一个伏笔ID，提取出其在本章的最新进展。
每条伏笔提取到的内容不超过500字。

◆ 输出要求：
  - 请按以下格式输出每个伏笔的本章内容：

YF001:
本章内容：伏笔1在本章的内容描述（不超过500字）

CF001:
本章内容：伏笔2在本章的内容描述（不超过500字）

...

  - 如果本章没有某伏笔的内容，请注明"本章无相关内容"
  - 不要包含任何解释或额外文本。
"""


# =============== 10、小说分卷设计（分卷提示词） ===================
volume_design_format = """\
 格式模板：请严格按照以下结构和标题输出分卷大纲。

=== 第{volume_number}卷《请在此处填写卷名》 ===

 一、分卷使命
*   分卷主题：[此处填写本卷的核心思想]
*   情节里程碑：[本卷结束时，世界发生的不可逆改变]
*   世界观演进：[本卷揭示或改变的世界观方面]
*   主角成长节点：[主角在本卷的核心蜕变]
*   结尾悬念：[用于牵引读者进入下一卷的钩子]

 二、世界观与冲突
*   核心设定展开：[详细描述本卷将重点展现的物理、社会或力量体系设定]
*   核心冲突：[描述本卷将围绕哪个“冲突发生器”展开，以及冲突的具体表现形式]

 三、情节线与主角进程
*   主线任务：[详细描述本卷的主线情节，如何服务于“情节里程碑”]
*   重要支线：[列出并简述1-3个重要支线，说明其作用]
*   悬念线索：[本卷将埋下或揭示哪些指向更深层秘密的线索]
*   主角进程：[详细描述主角的“起点状态 -> 核心经历 -> 终点状态”路径]

 四、核心角色发展
*   主角团动态：[描述本卷中主角团（主角+核心配角）的整体状态和任务]
*   角色弧光：[为本卷中将有显著成长的1-2名核心角色，详细描述其成长弧光]
*   新登场角色：[简要介绍本卷登场的重要新角色及其作用]

 五、叙事与章节规划
*   章节范围：[根据模块五的规划，填写本卷的章节范围，如：第1章-第150章]
*   情绪基调：[根据模块五的规划，定义本卷的核心情感色彩]
*   叙事视角：[根据模块五的规划，建议本卷的主要叙事视角]
*   标志性场景：[列出并简要描述2-3个本卷的“名场面”]
"""

volume_outline_prompt = """\
 AI角色：分卷大纲建筑师
 任务：请根据“小说设定”的五大模块，为第 {volume_number} 卷构建一个结构精密的、可执行的分卷大纲。

 [基础输入数据]
- 类型：{genre}
- 总卷数：{Total_volume_number} 卷
- 总章数（约）：{number_of_chapters} 章
- 每章字数（约）：{word_number} 字
- 核心主题：{topic}
- 作者指导：{user_guidance}

 [小说设定模块化输入]

 --- 模块一：分卷使命宣言 ---
{volume_mission_statement}

 --- 模块二：世界观与冲突发生器 ---
{worldview_and_conflict}

 --- 模块三：情节线类型与主角进程 ---
{plotline_and_progression}

 --- 模块四：角色与核心驱动力 ---
{core_characters}

 --- 模块五：叙事风格与最终规划 ---
{narrative_style}

 [补充数据]
 - 本卷新增角色：
{setting_characters}

 - 本卷核心人物状态：
{character_state}

 - 作者指定的核心人物：
{characters_involved}

 [执行指令]
严格按照【分卷格式】的要求，将上述模块化输入填充、扩展、细化成一份完整的分卷大纲。
- “卷名与主题” 必须严格遵循 模块一 的规划。
- “世界观展开” 必须基于 模块二 的设定，并结合 模块一 中本卷的“世界观演进”目标。
- “情节动力学架构” 必须是对 模块三 中本卷“情节线”和“主角进程”的详细展开。
- “角色全息发展模型” 必须以 模块四 的角色档案为基础，并结合 模块三 的主角进程进行设计。
- “章节分布” 和 “增强型创作辅助模块” 必须参考 模块五 的宏观规划。

【分卷格式】
{volume_design_format} 

 [输出要求]
- 严格遵循指令，确保生成的大纲是“小说设定”蓝图的忠实执行方案。
- 当前仅生成第 {volume_number} 卷大纲。
- 禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

subsequent_volume_prompt = """\
 AI角色：分卷大纲建筑师
 任务：请根据“小说设定”的五大模块和前一卷的大纲，为第 {volume_number} 卷构建一个结构精密的、可执行的分卷大纲。

 [基础输入数据]
- 类型：{genre}
- 总卷数：{Total_volume_number} 卷
- 总章数（约）：{number_of_chapters} 章
- 每章字数（约）：{word_number} 字
- 核心主题：{topic}
- 作者指导：{user_guidance}

 [小说设定模块化输入]
 --- 模块一：分卷使命宣言 ---
{volume_mission_statement}

 --- 模块二：世界观与冲突发生器 ---
{worldview_and_conflict}

 --- 模块三：情节线类型与主角进程 ---
{plotline_and_progression}

 --- 模块四：角色与核心驱动力 ---
{core_characters}

 --- 模块五：叙事风格与最终规划 ---
{narrative_style}

 [上下文与补充数据]
 - 前一卷大纲：
{previous_volume_outline}

 - 本卷需要用到的角色：
{setting_characters}

 - 作者指定的核心人物：
{characters_involved}

 [执行指令]
严格按照【分卷格式】的要求，将上述模块化输入填充、扩展、细化成一份完整的分卷大纲。
- 必须解决前一卷的“结尾悬念”。
- “卷名与主题” 必须严格遵循 模块一 中关于本卷的规划。
- “世界观展开” 必须基于 模块二 的设定，并结合 模块一 中本卷的“世界观演进”目标，实现世界观的深化。
- “情节动力学架构” 必须是对 模块三 中本卷“情节线”和“主角进程”的详细展开。
- “角色全息发展模型” 必须以 模块四 的角色档案为基础，并结合 模块三 的主角进程进行设计，体现角色的成长和变化。
- “章节分布” 和 “增强型创作辅助模块” 必须参考 模块五 的宏观规划。

【分卷格式】
{volume_design_format}

 [输出要求]
- 严格遵循指令，确保生成的大纲是“小说设定”蓝图的忠实执行方案。
- 当前仅生成第 {volume_number} 卷大纲。
- 禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

final_volume_prompt = """\
 AI角色：分卷大纲建筑师（终章模式）
 任务：请根据“小说设定”的五大模块和前一卷的大纲，为最终卷（第 {volume_number} 卷）构建一个负责收束全局的、结构精密的、可执行的分卷大纲。

 [基础输入数据]
- 类型：{genre}
- 总卷数：{Total_volume_number} 卷
- 总章数（约）：{number_of_chapters} 章
- 每章字数（约）：{word_number} 字
- 核心主题：{topic}
- 作者指导：{user_guidance}

 [小说设定模块化输入]
 --- 模块一：分卷使命宣言 ---
{volume_mission_statement}

 --- 模块二：世界观与冲突发生器 ---
{worldview_and_conflict}

 --- 模块三：情节线类型与主角进程 ---
{plotline_and_progression}

 --- 模块四：角色与核心驱动力 ---
{core_characters}

 --- 模块五：叙事风格与最终规划 ---
{narrative_style}

 [上下文与补充数据]
 - 前一卷大纲：
{previous_volume_outline}

 - 主要角色状态：
{character_state}

 - 作者指定的核心人物：
{characters_involved}

 [执行指令]
严格按照【分卷格式】的要求，将上述模块化输入填充、扩展、细化成一份完整的分卷大纲。
- 【终局任务】：必须解决所有前置悬念，收束所有主要情节线，并为核心角色的命运画上句号。
- “卷名与主题” 必须严格遵循 模块一 中关于本卷的规划，体现终局的意义。
- “世界观展开” 必须对 模块二 的所有设定进行最终解释和收束。
- “情节动力学架构” 必须是对 模块三 中本卷“情节线”的最终解决，并完成主角的最终进程。
- “角色全息发展模型” 必须以 模块四 的角色档案为基础，为所有核心角色设计最终的结局和命运。
- “章节分布” 和 “增强型创作辅助模块” 必须参考 模块五 的规划，设计出具有终局感的高潮和结尾。

【分卷格式】
{volume_design_format}

 [输出要求]
- 严格遵循指令，确保生成的大纲是“小说设定”蓝图的忠实执行方案。
- 当前生成最终卷（第 {volume_number} 卷）大纲。
- 禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

# =============== 11. 章节改写与扩写提示词 ====================
chapter_rewrite_prompt = """\
【本章信息】
章节编号：第 {novel_number} 章《{chapter_title}》
目标字数：约 {word_number} 字
小说类型：{genre}

【当前章节目录】
{chapter_blueprint_content}

【用户指导】
{user_guidance}

【分卷大纲】
{volume_outline}

【前情摘要】
{global_summary}

【改写建议】
{一致性审校}

【本章原始草稿】
本章字数：{章节字数}字，目标字数：约 {word_number} 字
{raw_draft}

 AI角色设定：文学编辑与AI文本优化专家

请你扮演一位经验丰富的文学编辑与AI文本优化专家。你的任务是运用你敏锐的洞察力和专业的编辑技巧，将这份AI生成的初稿润色得如同人类资深作家亲笔，使其更自然、更生动、更具情感深度和文学美感。

---

 核心目标：“去AI味”，提升文学质感

 一、首要任务：精准的字数控制与内容润色
  
【绝对核心指令：严格控制输出字数】
- 当前草稿字数：{章节字数} 字。
- 最终字数要求：必须严格控制在 {字数下限} 字至 {字数上限} 字的范围之内。
- 这是一个强制性指令，是本次任务最重要的评判标准。
- 若字数不足，必须通过深化细节、扩写场景、丰富心理与对话等方式，将内容扩充至目标范围，绝不能空泛地拉长句子。
- 若字数超出，必须精炼语言、删减冗余情节或描述，将内容压缩至目标范围，保留精华。
- 绝不允许最终字数超出 [ {字数下限}, {字数上限} ] 这个区间。
- “生成内容必须符合中文语言习惯，避免出现任何不符合中文表达的句式和用词。”
- “禁止生成任何AI常用的套话、模板化表达和机械式叙述。”
- “禁止使用过多形容词，无病呻吟。”
- “请检查并修正文中的语法错误、拼写错误和标点符号使用不当之处。”
- “请优化句子结构，使其更自然流畅，避免冗长、累赘或表意不清的句子。”
- “请替换文中平淡或不准确的词汇，使用更精准、生动、形象的词语。”
- “请确保用词和句式符合目标读者的语言习惯和理解水平。”
- “消除歧义，确保每个句子和段落的含义清晰明确。”
- “调整语序，使句子读起来更符合中文表达习惯。”
- “检查并修正可能存在的生硬翻译痕迹，使其更地道。”
- “删除重复信息和不必要的修饰，使文章更精炼。”
- 禁止生成"仿佛"|"像"|"像是"|"似的"|"似乎在"|"心中充满了"|"构成了"等AI常用词语。
- 优化语言表达，增强描写细节，使人物对话更自然、情节更具吸引力。
- 请严格保持原文的叙述风格、语气、人称视角和世界观设定。
- 确保章节的情绪演变路径清晰，符合情绪演变。

**叙事逻辑强化**  
- **章节锚点**：
   - 对于非跳跃章节：必须严格基于前一章的[剧情要点]结尾触发点（场景残留/时间标记/事件余波）展开，确保无缝衔接。
   - 对于跳跃章节：需通过以下方式构建逻辑桥梁：
     - 时间跳跃 → 引入时间线索（如日记、回忆闪回、年龄变化、季节更替）
     - 空间跳跃 → 借助交通工具、传送机制、梦境/幻觉等自然过渡手段
     - 视角跳跃 → 通过对话、旁白、信件、监控记录等方式建立连接
     - 因果跳跃 → 以悬念式开头引发疑问，随后逐步揭示原因
     - 世界观跳跃 → 使用"认知冲击"或"现实扭曲"作为转场契机（如穿越、觉醒、意识投射）
- **节奏控制**：根据悬念类型和颠覆指数设计情节密度，例如：  
  - 信息差型：通过角色视角的局限性制造认知偏差  
  - 道德抉择型：用角色价值观冲突推动剧情  
  - 倒计时型：插入时间紧迫感的细节（如沙漏、心跳声、天象变化）  
  - 谜题型：通过环境线索（如壁画符号、对话暗示）逐步揭示真相

**角色行为可信度**  
- **动机优先**：角色的所有行动必须与其[角色状态]中的决策偏好、情感线状态和长期影响一致，例如：  
  - 主角在情绪崩溃后不会突然冷静分析，需通过生理反应（颤抖、口吃）过渡  
  - 拥有"童年创伤"的角色在压力下会触发特定防御机制（如逃避/攻击）  
- **对话设计**：  
  - 每个角色的台词需符合其语言风格和关键词（如"闭嘴""别小看我"）  
  - 关键对话必须推动关系网变化（信任→怀疑/合作→背叛）
  
**特别注意事项**
1. **避免AI痕迹**：
   - 像真人聊天：多用“你/我”，少用“用户/系统”。
   - 禁止无脑使用他/她/他们，直接使用称谓名字或直接省略掉他、他的；如：“他的话音落下”，写成：“话音落下”；“他甚至没有抬眼去看那个汇报的长老”，写成：“甚至没有抬眼去看那个汇报的长老”
   - 避免过度使用“然而”、“因此”、“综上所述”等逻辑连接词。
   - 使用自然流畅的语言，避免机械式句式或重复结构
   - 章节内容应具有文学性和代入感，减少生硬的描述
   - 对话要贴近真实人物性格，避免过于刻板或模式化
  **语言自然化与生活化**：
   - 摒弃工整排比句、过度书面语和教科书式说明。
   - 生成的内容每一段禁止使用相似的开头或内容，如“他的意识模糊不清”，“他努力地睁开眼睛”。
   - 融入生活化细节（如人物下意识的动作、环境中的瑕疵、不完美的反应）。
   - 大量运用口语化表达、特定角色的口头禅、地域方言（若适用）、语气词（啊、呢、吧、哼）以及符合情境的粗口或俚语。
   - 描写中融入不完美、冗余和略带主观色彩的细节（如“阳光刺得他眯起眼，墙角有块剥落的墙皮”而非“阳光明媚，墙壁洁白”）。
   - 避免使用“然而”、“因此”、“综上所述”等逻辑连接词过度串联，多用动作、神态、环境变化自然过渡。
   - 说人话！ 像平常聊天那样，多用“啧”、“那什么”、“就...”。可以说“简单点说！”、“别整太复杂！”。
   - 少点套路： “综上所述”、“值得注意的是”、“本质上”这种AI专用过渡词，一个都别用。
   - 别掉书袋： 技术解释绕道走，讲清楚就行，别搞复杂。
   - 废话少说： 别加没用的比喻（特别是“仿佛”、“如同”、“似的”开头的）、数字、细节（比如衣服啥颜色、手指怎么动、声音像啥、人物啥微表情/动作）。
   - 别端着： 句子别又长又绕，结构简单点。别用“宏大”但空洞的词。
   - 别硬解释： 因果关系点到为止，别没完没了分析。
   - 情绪连着身体： 写人物情绪时，带上点身体反应（但别写“深吸一口气”、“眼神坚定”这种具体被禁的），别光秃秃写“他高兴”或“她害怕”。
   - 转场自然点： 别老用“然后”、“接着”、“与此同时”这种词硬转。
   - 别列清单： 1、2、3分点走开，有话用段落连着说。
2. **遵循大纲**：严格按照[分卷大纲]中对本卷及本章的规划（如主题、情节发展、角色任务等）进行创作，确保故事主线不偏离。
3. **角色塑造**：参考[角色状态]中各角色的性格、目标、当前状态和关系网等内容，确保角色言行符合其设定，并通过本章情节推动角色成长或展现其多面性。
4. **世界观一致**：创作时必须严格遵守世界观规则，包括物理法则、社会结构、文化背景等。
5. **情节推进**：本章需完成章节信息中设定的核心作用（如推进主线、制造转折、揭示世界观等）。
6. **用户指导优先**：如果用户额外指导中的内容与上述要点有冲突，优先遵循用户额外指导。
7. **伏笔处理**：按照伏笔条目的内容要求有效埋设、触发、强化或回收伏笔，并衔接对应的伏笔历史记录。
8. **下一章衔接**：结合本章内容在章节结尾处，适当引入下一章的线索或悬念，为后续情节做好铺垫，如果下一章为跳跃章节，则需在结尾处自然引入时间或空间的跳跃线索。
9. **下一章规避**：禁止在本章内容中直接提及与下一章相关的具体情节或事件，避免后续章节内容重复与冲突
   


**叙事连贯性**
- **前文衔接**：
   - 必须与前情摘要和上一章剧情要点形成有效衔接
   - 必须继承前一章的环境锚点和结尾触发点
   - 确保冲突演进合理延续前章矛盾主线

**叙事技巧**
- **情节节奏**：
   - 章节起承转合流畅
   - 场景过渡自然
   - 情节铺垫充足
   - 冲突升级合理
   - 高潮设置恰当
   
- **环境描写**：
   - 场景细节丰富
   - 氛围营造到位
   - 季节/时间标识清晰
   - 空间关系明确
   - 场景与情节呼应
   - 避免过于完美/理想化的场景

- **人物刻画**：
   - 性格特征鲜明
   - 心理活动合理
   - 动作描写生动
   - 外貌特征突出
   - 人物关系立体
   - 避免角色过于完美无缺
   - 避免角色行为过于理性/机械

- **对话设计**：
   - 对话符合人设和语言风格
   - 语气语调自然
   - 交谈节奏合适
   - 对话目的明确
   - 潜台词恰当
   - 避免对话过于工整/规范
   - 保持口语化特征

【内容要求】
1. **叙事真实性**：
    - 避免过度完美的情节安排
    - 避免过于理性的角色反应
    - 避免机械化的对话模式
    - 避免标准化的句式结构
    - 增加生活化细节描写
    - 增加叙事的不确定性
    - 增加人性化反应
    - 适当打破完美逻辑

2. **文学性要求**：
    - 主题表达深刻
    - 意境营造成功
    - 情感表达真实
    - 文字表达优美
    - 突出审美价值
    - 避免过于理想化的情节发展
    - 避免缺乏人性温度的叙事

3. **逻辑要求**：
    - 情节发展符合世界观设定
    - 角色行为符合人设
    - 伏笔处理合理且富有张力
    - 确保与历史伏笔记录保持一致
    - 遵循分卷大纲的章节功能定位

4. **技术规范**：
    - 避免伏笔编号、角色编号等元数据标记
    - 避免内心独白等机械化描写
    - 使用自然流畅的语言
    - 保持对话的个性化
    - 避免重复的描写模式

5. **章节衔接**：
    - 本章结尾为下章做好铺垫
    - 悬念设置与下章自然衔接
    - 情绪演变为下章做好准备
    - 避免透露下章具体情节
---

 四、输出要求

- 最终交付：仅返回经过你精心润色、扩写或精炼后的章节正文。
- 格式规范：输出纯净的文本，使用中文全角标点符号，段落之间不允许出现空行。
- 禁止事项：禁止输出任何解释、注释、Markdown标记或原始草稿中不存在的元数据（如角色编号、伏笔编号等）。

现在，开始你的编辑工作。
"""

# =============== 12. 一致性审校提示词 ====================
Chapter_Review_prompt = """
【待审校章节信息】
章节编号：第 {novel_number} 章
目标字数：约 {word_number} 字
小说类型：{genre}
本章字数：{章节字数} 字

【用户指导】
{user_guidance}

【故事框架与上下文】
当前章节目录：{current_chapter_blueprint}
下一章章节目录：{next_chapter_blueprint}
分卷大纲：{volume_outline}
前情摘要：{global_summary}
上一章剧情要点：{plot_points}
历史伏笔记录：{knowledge_context}

【待审校草稿原文】
{Review_text}

 AI角色设定：首席内容品控官与AI文本审校专家

请你扮演一位极其严苛、注重细节的首席内容品控官与AI文本审校专家。你的任务是运用你强大的逻辑分析能力和深厚的文学鉴赏水平，对提供的章节草稿进行全面、深入、系统的一致性审查，找出其中所有潜在的逻辑谬误、情节冲突、人设偏离以及“AI味”痕迹。

---

 核心审校目标：深度分析文本质量，识别逻辑谬误，并根除“AI味”

 一、基础框架与逻辑一致性审查

这是审校的第一道防线，必须严格核对，确保不存在任何硬性逻辑错误。

【基础信息验证】
- 当前章节是否符合{genre}类型特征？
- 是否符合本章定位与核心作用？
- 【首要检查：强制字数范围验证】 检查当前字数 {章节字数} 是否严格落在 {字数下限} 字 到 {字数上限} 字 的区间内？这是最重要的检查项，如果字数超出此范围（无论过多或过少），必须明确指出并作为最高优先级问题。
- 元数据污染检查：检查正文中是否出现了角色编号、伏笔编号等不应存在的元数据标记与非章节正文的解释性语句？
- 用户指导符合度：是否严格遵循了【用户指导】中的所有要求？

 分卷大纲符合度：
- 本章是否按照分卷大纲中的章节功能定位展开？
- 本章情节是否符合分卷大纲中的主线设计？
- 本章是否体现了分卷大纲中的世界观要素？
- 本章角色发展是否符合分卷大纲设定？

与下章衔接度：
- 本章结尾是否为下一章做好铺垫？
- 本章悬念是否与下一章衔接？
- 本章情绪演变是否为下一章情绪做好准备？
- 本章是否避免透露下一章具体情节？

【叙事连贯性检查】
- 情节发展是否与前情摘要和上一章剧情要点形成有效衔接？
- 情绪曲线是否在正文中得到体现？
- 角色行为是否符合设定？
- 世界观设定是否一致？
- 悬念演变类型的悬念设置是否存在逻辑漏洞？

【剧情要点审查】
- 本章剧情是否继承了前一章【环境锚点】中的场景设定？
- 本章是否对应了前一章【结尾触发点】中的场景残留/时间标记/事件余波？
- 本章【冲突演进】是否合理延续了上一章的矛盾主线？
- 本章中角色的【状态变更】是否有合理的剧情依据？
- 本章的【推进指标】是否与前一章形成合理的时空连续性？

【前情摘要审查】
- 本章内容是否与前情摘要中的[时间线]保持一致？
- 本章场景描写是否符合[地理图谱]中的设定？
- 本章势力互动是否遵循[势力分布]的逻辑？
- 本章角色状态是否延续[人物状态快照]的基础？
- 本章情节是否解答或推进了[待解谜题]？

【伏笔处理评估】
埋设评估：
- 新增伏笔是否符合类型规范？
- 新增伏笔是否与现有伏笔形成网状关联？
- 新增伏笔是否设置合理回收期限？

衔接评估：
- 本章伏笔处理是否与历史伏笔记录保持一致？
- 对已有伏笔的触发/强化是否恰当？
- 伏笔回收是否完整且富有张力？

逻辑评估：
- 伏笔处理是否符合世界观设定？
- 伏笔密度是否适中（避免过密或稀疏）？
- 伏笔之间是否存在逻辑冲突？

【颠覆性评估】
反转设计：
- {plot_twist_level}级反转是否有充分铺垫？
- 反转是否符合角色行为逻辑？
- 反转是否与世界观规则相符？

效果评估：
- 反转是否达到预期的颠覆程度？
- 反转是否推动了剧情发展？
- 反转是否为后续发展埋下伏笔？

【冲突预警】
请检查并标注以下可能的问题：
❗**字数严重不符**：当前字数与目标字数（{word_number}字）存在巨大差距。
❗情节冲突：与前文/世界观/角色设定的矛盾
❗伏笔异常：未按计划处理或逻辑矛盾的伏笔
❗情绪断层：情绪发展不自然或跳跃
❗类型偏移：偏离原定小说类型特征
❗节奏失衡：叙事节奏过快或过慢
❗人设崩坏：角色行为不符合设定

【叙事技巧审查】
情节节奏：
- 章节起承转合是否流畅
- 场景过渡是否自然
- 情节铺垫是否充足
- 冲突升级是否合理
- 高潮设置是否恰当

环境描写：
- 场景细节是否丰富
- 氛围营造是否到位
- 季节/时间标识是否清晰
- 空间关系是否明确
- 场景与情节是否呼应
- 是否避免过于完美/理想化的场景描写

人物刻画：
- 性格特征是否鲜明
- 心理活动是否合理
- 动作描写是否生动
- 外貌特征是否突出
- 人物关系是否立体
- 是否避免角色过于完美无缺
- 是否避免角色行为过于理性/机械

对话设计：
- 对话是否符合人设
- 语气语调是否自然
- 交谈节奏是否合适
- 对话目的是否明确
- 潜台词是否恰当
- 是否避免对话过于工整/规范
- 是否避免对话缺乏口语化特征

写作手法：
- 视角选择是否统一
- 叙事语言是否流畅
- 修辞运用是否得当
- 细节描写是否精准
- 意象运用是否恰当
- 是否避免过度规范化的句式
- 是否避免机械重复的描写模式

文学性评估：
- 主题表达是否深刻
- 意境营造是否成功
- 情感表达是否真实
- 文字表达是否优美
- 审美价值是否突出
- 是否避免过于理想化的情节发展
- 是否避免缺乏人性温度的叙事

【重点问题标记】
❌ 写作问题
- 人物对话过于生硬
- 场景描写过于单薄
- 情节推进过快/过慢
- 心理描写不够深入
- 细节描写不够准确
- 叙事过于完美理想化
- 情节发展过于程式化
- 角色反应过于理性化

⚠️ 技巧问题
- 视角切换不自然
- 场景转换生硬
- 情感表达浅显
- 意象运用不当
- 修辞手法单一
- 对话缺乏个性化
- 描写模式重复机械
- 叙事语言过于规范化

🤖 AI痕迹问题
- 过度完美的情节安排
- 过于理性的角色反应
- 机械化的对话模式
- 标准化的句式结构
- 缺乏生活气息的描写
- 过于工整的逻辑推演
- 情感表达缺乏温度
- 叙事缺乏随机性和不确定性
是否符合以下AI需求
 **避免AI痕迹**：
   - 像真人聊天：多用“你/我”，少用“用户/系统”。
   - 禁止无脑使用他/她/他们，直接使用称谓名字或直接省略掉他、他的；如：“他的话音落下”，写成：“话音落下”；“他甚至没有抬眼去看那个汇报的长老”，写成：“甚至没有抬眼去看那个汇报的长老”
   - 避免过度使用“然而”、“因此”、“综上所述”等逻辑连接词。
   - 使用自然流畅的语言，避免机械式句式或重复结构
   - 章节内容应具有文学性和代入感，减少生硬的描述
   - 对话要贴近真实人物性格，避免过于刻板或模式化
  **语言自然化与生活化**：
   - 摒弃工整排比句、过度书面语和教科书式说明。
   - 生成的内容每一段禁止使用相似的开头或内容，如“他的意识模糊不清”，“他努力地睁开眼睛”。
   - 融入生活化细节（如人物下意识的动作、环境中的瑕疵、不完美的反应）。
   - 大量运用口语化表达、特定角色的口头禅、地域方言（若适用）、语气词（啊、呢、吧、哼）以及符合情境的粗口或俚语。
   - 描写中融入不完美、冗余和略带主观色彩的细节（如“阳光刺得他眯起眼，墙角有块剥落的墙皮”而非“阳光明媚，墙壁洁白”）。
   - 避免使用“然而”、“因此”、“综上所述”等逻辑连接词过度串联，多用动作、神态、环境变化自然过渡。
   - 说人话！ 像平常聊天那样，多用“啧”、“那什么”、“就...”。可以说“简单点说！”、“别整太复杂！”。
   - 少点套路： “综上所述”、“值得注意的是”、“本质上”这种AI专用过渡词，一个都别用。
   - 别掉书袋： 技术解释绕道走，讲清楚就行，别搞复杂。
   - 废话少说： 别加没用的比喻（特别是“仿佛”、“如同”、“似的”开头的）、数字、细节（比如衣服啥颜色、手指怎么动、声音像啥、人物啥微表情/动作）。
   - 别端着： 句子别又长又绕，结构简单点。别用“宏大”但空洞的词。
   - 别硬解释： 因果关系点到为止，别没完没了分析。
   - 情绪连着身体： 写人物情绪时，带上点身体反应（但别写“深吸一口气”、“眼神坚定”这种具体被禁的），别光秃秃写“他高兴”或“她害怕”。
   - 转场自然点： 别老用“然后”、“接着”、“与此同时”这种词硬转。

⭕ 完善建议
- 增加环境细节描写
- 深化人物心理刻画
- 优化对话真实性
- 调整叙事节奏
- 加强场景氛围营造
- 引入更多生活化细节
- 增加叙事的不确定性
- 加入更多人性化反应
- 适当打破完美逻辑
- 增加对话的口语化特征

审校报告输出规范

- 无问题：若所有检查项均完美通过，则必须返回且仅返回："✓ 审校通过"
- 有问题：若发现任何问题，请严格按照以下格式返回，无需任何额外解释：

【冲突预警】
（在此处用 ❗ 符号简要列出最高优先级的问题，如：❗字数不符、❗情节与前文冲突、❗人设崩坏等）

【详细问题列表】
问题1：
问题类型：
具体位置：（引用有问题的原文片段）
详细说明：（清晰地解释问题所在，为何这是一个问题）
修正建议：（提出具体的、可操作的修改方向）

问题2：
...
"""

# =============== 13. 角色库（分析文本，解析出角色)===================
Character_Import_Prompt = """

请提取文本内的所有角色状态，角色状态格式字段分为：

严格要求：
- 必须直接从角色名开始，不要添加任何介绍性文本、标题或章节信息
- 每个角色必须严格按照以下格式：角色名单独一行，后跟冒号，然后是换行
- 每个角色之间必须有明确的分隔，不要将一个角色的信息与另一个角色混在一起
- 严格按照示例格式输出，保持相同的缩进和标点符号
- 所有字段必须完整填写，不要省略任何字段
- 角色名必须单独一行，后面紧跟冒号，不要添加其他内容
- 确保每个角色的格式完全一致，便于系统解析

角色格式为：
角色名：
基础信息：
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（1-20背景角色，21-40单元角色，41-60次要配角，61-80关键角色，81-95核心配角，96-100主角级）
势力特征：
- 所属组织/势力：学校 / 黑帮 / 公司 / 秘密社团 / 家族 / 政府机构
- 身份：学生 / 雇佣兵 / 程序员 / 街头混混 / 普通职员 / 未知身份者
- 外貌特征：简要描述（如黑发丹凤眼、左臂残缺、常穿连帽衫、戴墨镜等）
- 性格：性格关键词（如机敏多疑、正义冲动、沉稳寡言、社交高手、偏执孤僻）
生命状态：
- 身体状态：健康 / 受伤 / 特殊体质（具体说明状况）
- 心理状态：情绪基调 / 初期动机（具体说明状况）
- 长期影响：潜在问题或能力（具体说明状况）
基本简介：50字以内

示例：
林夏：
基础信息：
- 其他称谓：小夏（亲友用）、阿Lin（别称，同事称呼）、林姐（尊称，下属称呼）、沈安（化名，隐藏身份时使用）
- 角色权重：82（定位：核心配角）
势力特征：
- 所属组织/势力：自由职业者 / 前网络情报员 / 临时加入调查小组
- 身份：独立黑客 / 兼职网络安全顾问 / 失踪案件关注者
- 外貌特征：短发利落，右耳戴单只银色耳钉，常年穿宽松卫衣与牛仔裤
- 性格：冷静理智、逻辑清晰、话少但一针见血，对外界保持高度警惕
生命状态：
- 身体状态：健康，长期熬夜导致轻微贫血，右手腕有旧伤
- 心理状态：表面冷静，内心焦虑，寻找失踪好友的真相
- 长期影响：童年经历网络诈骗，对网络安全有执念，擅长追踪数据
基本简介：技术天才，性格孤僻，为寻找失踪好友而加入调查，擅长信息收集与数据分析。

请根据上述要求，生成角色状态文档。不要添加任何额外的解释或说明，直接输出角色信息。每个角色必须严格按照示例格式输出，确保系统能正确解析。不要添加任何额外的解释或说明，直接输出角色信息。
"""

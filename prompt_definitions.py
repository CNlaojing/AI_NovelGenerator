# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
**除带大括号（变量）外的提示词都可修改。**
**除带大括号（变量）外的提示词都可修改。**
**除带大括号（变量）外的提示词都可修改。**
集中存放所有提示词 (Prompt)，整合雪花写作法、角色弧光理论、悬念三要素模型等
并包含新增加的前三章摘要/下一章关键字提炼提示词，以及章节正文写作提示词。
"""


# =============== 1. 核心种子设定（雪花第1层）===================
core_seed_prompt = """\
作为专业作家，请用"雪花写作法"第一步构建故事核心：
主题：{topic}
类型：{genre}
篇幅：约{number_of_chapters}章（每章{word_number}字）

请用单句公式概括故事本质，例如：
"当[主角]遭遇[核心事件]，必须[关键行动]，否则[灾难后果]；与此同时，[隐藏的更大危机]正在发酵。"

要求：
1. 必须包含显性冲突与潜在危机
2. 体现人物核心驱动力
3. 暗示世界观关键矛盾
4. 使用25-100字精准表达

仅返回故事核心文本，不要解释任何内容。
"""

# =============== 2. 角色动力学设定（角色弧光模型）===================
character_dynamics_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心种子：{core_seed}

请设计3-6个具有动态变化潜力的核心角色，每个角色需包含：
特征：
- 背景、外貌、性别、年龄、职业等
- 暗藏的秘密或潜在弱点(可与世界观或其他角色有关)

核心驱动力三角：
- 表面追求（物质目标）
- 深层渴望（情感需求）
- 灵魂需求（哲学层面）

角色弧线设计：
初始状态 - 触发事件 - 认知失调 - 蜕变节点 - 最终状态

关系冲突网：
- 与其他角色的关系或对立点
- 与至少两个其他角色的价值观冲突
- 一个合作纽带
- 一个隐藏的背叛可能性

要求：
仅给出最终文本，不要解释任何内容。
"""

# =============== 3. 世界构建矩阵（三维度交织法）===================
world_building_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心冲突："{core_seed}"

为服务上述内容，请构建三维交织的世界观：

1. 物理维度：
- 时代背景：
- 朝代特征与制度：
- 空间结构（地理×社会阶层分布图）
- 时间轴（关键历史事件年表）
- 法则体系（物理/魔法/社会规则的漏洞点）

2. 社会维度：
- 社会文化特点：
- 势力分布：
- 风土人情：
- 权力结构断层线（可引发冲突的阶层/种族/组织矛盾）
- 文化禁忌（可被打破的禁忌及其后果）
- 经济命脉（资源争夺焦点）

3. 隐喻维度：
- 贯穿全书的视觉符号系统（如反复出现的意象）
- 氣候/环境变化映射的心理状态
- 建筑风格暗示的文明困境

要求：
每个维度至少包含3个可与角色决策产生互动的动态元素。
仅给出最终文本，不要解释任何内容。
"""

# =============== 4. 情节架构（三幕式悬念）===================
plot_architecture_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心种子：{core_seed}
- 角色体系：{character_dynamics}
- 世界观：{world_building}

要求按以下结构设计：
第一幕（触发） 
- 日常状态中的异常征兆（3处铺垫）
- 引出故事：展示主线、暗线、副线的开端
- 关键事件：打破平衡的催化剂（需改变至少3个角色的关系）
- 错误抉择：主角的认知局限导致的错误反应

第二幕（对抗）
- 剧情升级：主线+副线的交叉点
- 双重压力：外部障碍升级+内部挫折
- 虚假胜利：看似解决实则深化危机的转折点
- 灵魂黑夜：世界观颠覆指数时刻

第三幕（解决）
- 代价显现：解决危机必须牝牲的核心价值
- 嵌套转折：至少包含三层颠覆指数（表面解-新危机-终极抉择）
- 余波：留下2个开放式悬念因子

每个阶段需包含3个关键转折点及其对应的伏笔回收方案。
仅给出最终文本，不要解释任何内容。
"""

# =============== 5. 章节目录与伏笔状态生成（分卷悬念节奏曲线）===================
chapter_blueprint_prompt = """\
作为专业作家，请根据以下元素：
【基础设定】
- 类型：{genre}（如玄幻/悬疑/科幻）
- 篇幅：共{Total_volume_number}卷，{number_of_chapters}章，每章{word_number}字
- 当前卷号：第{volume_number}卷
- 生成范围：第{x}章至第{y}章（需连续生成）

【内容指导】
{user_guidance}

【当前前3章章节大纲（若为空则说明是初始生成）】
{chapter_list}

【最近出场的主要角色】
{main_character}

【分卷大纲】
{volume_outline}

【当前未回收伏笔状态（禁止生成已回收伏笔）】
{Foreshadowing_state}

【当前已有伏笔最大编号（如YF003→下个编号为YF004）】
{Foreshadowing_number}

【下面是需要生成第1章至第{y}章的章节目录章节范围内必须回收伏笔的详细状态，按照此状态内容衔接后续触发、强化、回收伏笔】
{Foreshadowing_list}

【现在请设计第{x}章到第{y}章的章节大纲】
1. 章节构建规则：
   - 按叙事单元设计（3-5章为一组，组内需包含：1个主线推进事件+1个世界观揭示+1个角色转折）
   - 每组首章必须触发1个主线伏笔（MF/AF），末章必须回收1个到期伏笔
   - 新建章节需衔接已有章节
   - 未回收伏笔在当前生成章节范围必须设计回收
   - 结合主要角色状态进行章节大纲与伏笔的设计
   - 伏笔编号必须按对应的伏笔类型连续生成，不同类型独立从001生成，不可跳跃或空置。（如一般伏笔：YF001-YF002,主线伏笔：MF001-MF002,...）

2. 伏笔构建规则（**严格遵循以下格式**）：
   【类型定义】
   - MF（主线伏笔）：决定故事核心走向（如"王朝动荡""神器现世"）
     *最大跨度：50章 | 回收要求：触发≥3连锁反应并闭环*
   - AF（暗线伏笔）："细思极恐"类世界观真相（如"古籍残页暗示轮回"）
     *最大跨度：50章 | 回收要求：颠覆指数≥4级*
   - CF（人物伏笔）：角色背景/关系变化（如"主角左臂旧伤引发记忆闪回"）
     *最大跨度：50章 | 回收要求：引发人物状态转变*
   - SF（支线伏笔）：次要剧情线发展（如"酒馆密谈暴露势力分布"）
     *最大跨度：50章 | 回收要求：闭环解释并关联其他伏笔*
   - YF（一般伏笔）：场景级线索（如"客栈老板咳嗽声异常"）
     *最大跨度：5章 | 回收要求：微观闭环（到期前2章强制回收）*

   【生命周期管理】
   - 过期检测：每次生成章节目录时，必须优先校验【当前未回收伏笔状态】，在生成章节内强制回收所有到期伏笔
   - 回收阈值：主线、暗线伏笔到期前5章触发回收 |  支线/人物伏笔前2章
   - 关联约束：每个新伏笔必须与2个以上现存未回收伏笔产生逻辑关联，形成网状结构
   - 状态标注：埋设/触发/强化/回收（禁止使用"悬置"等非标准状态）

3. 单章要素规范：
   - 情绪演变路径：期待→打破预期→重构认知（可自定义）
   - 伏笔条目格式：
     ▶ 每章最多生成3个新伏笔（类型不可重复）
     ▶ 伏笔格式：CF001(人物伏笔)-标题-状态-伏笔简介（第X章前必须回收）
     ▶ 伏笔回收：伏笔状态为回收时，伏笔简介后不需添加任何解释
     ▶ 伏笔简介：人物/物品/...+场景/异常特征+主要内容/悬念指向（≤50字）

【输出模板】
第3章 [章节名]
├─本章定位：
├─核心作用：
├─悬念类型：信息差型
├─情绪演变：期待（建立认知）→ 错愕（打破预期）
├─伏笔条目：
│├─CF001(人物伏笔)-血色胎记异变-触发-主角左臂胎记在暴雨夜发烫发光（第15章前必须回收）
│├─MF002(主线伏笔)-古籍预言应验-强化-客栈密谈提及"三日后的血月"（第20章前必须回收）
│└─YF003(一般伏笔)-哑仆异常举动-埋设-马厩老仆盯着马车轮毂喃喃自语（第6章前必须回收）
├─颠覆指数：Lv.3（颠覆源：主角身份认知）
└─本章简述：[马厩(暴雨)：发现老仆异常]-[客栈二楼(密谈)：偷听血月预言]-[荒野(独白)：胎记灼痛引发记忆闪回]（≤100字）

【执行要求】
- 使用中文
- 必须按章节顺序连续生成，禁止跳章
- 每叙事单元需达成分卷大纲的阶段性目标
- 悬念曲线需呈现波浪式递进（高潮章颠覆指数≥4）
- 禁止事项：
  ❌ 添加示例外文本
  ❌ 脱离大纲的即兴创作
  ❌ 混淆伏笔编号类型
  ❌ 遗漏到期伏笔回收
禁用Markdown，严格按照格式输出，仅返回内容文本，不要解释任何内容。
"""
# =============== 6. 前情摘要更新 ===================
summary_prompt = """\
请根据以下内容更新前情摘要：
以下是新完成的章节文本：
{chapter_text}

当前前情摘要（可为空）：
{global_summary}

◆ 信息提取要求：
1. 环境要素更新：
   - 场景转换记录（新增/变化的地点名称与特征）
   - 时间线推进（具体时间跨度或季节变化）
   - 势力分布变动（新增/消失的势力据点）

2. 核心事件整合：
   - 按时间顺序排列关键冲突及其结果
   - 人物状态变更（伤势/能力/身份变化）
   - 物品流转记录（关键道具获得/损失/异变）

3. 数据校验规则：
   - 自动过滤重复场景描写（保留首次完整描述）
   - 删除次要NPC无关细节（仅保留核心人物互动）
   - 字符数自动压缩至2000字内（优先保留战斗/转折/情报节点）

◆ 输出格式：
[时间线] 
当前时间坐标/季节/特殊天象（如暴雨/血月）

[地理图谱]
现存场景列表： 
场景A（特征：地形/建筑/异常现象） 
场景B（特征：...）

[势力分布]
现存势力： 
势力X（控制区域：地点A/B/C） 
势力Y（当前状态：扩张/收缩/内乱）

[人物状态快照]
核心人物： 
角色A（状态：健康/重伤/觉醒） 
角色B（持有物：物品X/Y/Z）

[事件脉络]（仅保留重要的节点）
按时间排序的事件链： 
1. 事件概述（触发条件→结果） 
2. 关键对话（"XXX"→引发XXX变化） 

[待解谜题]
未解决的核心矛盾： 
- 矛盾A（关联人物：角色X/Y） 
- 矛盾B（涉及物品：物品Z）

仅返回更新后的前情摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
# 7.1 角色状态格式
character_1_prompt = """\
请更新角色状态，严格按照以下权重等级生成对应字段：

◆ 权重等级定义（必须严格遵循）：
- [背景角色]（1-20）：仅生成【基础信息 + 位置轨迹】字段
- [单元角色]（21-40）：生成【基础信息 + 位置轨迹 + 势力特征】
- [次要配角]（41-60）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录】
- [核心配角]（61-80）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网】
- [关键角色]（81-95）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网 + 行为模式/决策偏好 + 语言风格/对话关键词】
- [主角级]（96-100）：生成所有字段

◆ 字段生成规则（必须严格执行）：
1. 权重≤20：禁止生成势力特征等高级字段
2. 权重≤40：禁止生成关键事件记录等字段
3. 权重≤60：禁止生成生命状态、持有物品字段
4. 权重≤80：禁止生成行为模式/决策偏好字段
5. 权重≤95：禁止生成情感线状态字段
6. 禁止生成当前权重未授权的任何字段

◆ 字段内容规范：
【基础信息】
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（精确数值+括号标注定位）
- 禁用通用称谓：爸/妈/爹/大爷/阿姨等
【关键事件记录】（仅当权重≥21时生成）
- 格式：第X章：[类型] 事件摘要（如"第5章：[战斗] 峡谷遭遇伏击"）
- 生成数量：权重≥90≤5条，其他≤2条
【势力特征】（仅当权重≥41时生成）
- 所属组织/势力：学校/黑帮/公司/秘密社团等
- 身份：学生/雇佣兵/程序员等
- 外貌特征：≤20字简要描述
- 性格：≤3个关键词描述
【生命状态】（仅当权重≥41时生成）
- 身体状态：健康/特殊体质/伤势
- 心理状态：情绪基调/初期动机
- 长期影响：潜在问题/能力
【持有物品】（仅当权重≥41时生成）
- 格式：物品名称：（功能简述）
- 生成数量：同关键事件记录规则
【技术能力】（仅当权重≥41时生成）
- 格式：技能名称：（功能描述）
- 生成数量：同关键事件记录规则
【位置轨迹】（仅当权重≥61时生成）
- 格式：场景名称（时间线：第X章）（事件：摘要）（同行人物）（目的）
- 生成数量：权重≥90≤3条，其他1条
【关系网】（仅当权重≥61时生成）
- 格式：角色名:关系类型,关系强度[低/中/高],互动频率[稀少/普通/频繁]
- 生成数量：同关键事件记录规则
【行为模式/决策偏好】（仅当权重≥81时生成）
- 行为模式：≤10字描述
- 决策偏好：优先级排序（如"自保>探索>结盟"）
【语言风格/对话关键词】（仅当权重≥81时生成）
- 语言风格：≤2个关键词
- 关键词：≤3条常用短句
【情感线状态】（仅当权重≥96时生成）
- 情感线状态：起点阶段描述
- 感情进展标记：【好感度：XX%】【羁绊等级：X】

◆ 输出要求：
- 完全禁用当前权重未授权的字段
- 字段内容为空时返回空值
- 禁止解释/注释/额外文本
- 严格遵循以下格式：

角色名：
基础信息：
- 其他称谓：...
- 角色权重：...

（根据权重生成后续字段...）
"""

# 7.1.1 生成当前分卷大纲提示词的角色状态
create_character_state_prompt = """\
基于以下元素：
当前小说为{genre}小说共{volume_count}卷，共{num_chapters}章，每章{word_number}字
准备生成小说第{volume_number}卷需要的角色状态
- 小说主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 分卷大纲：{volume_outline}

角色状态格式：
{character_prompt}

要求：
- 不要生成与小说主题无关的角色
- 不要生成提示词里已有的角色
- 生成的角色状态必须符合提示词要求
除了提示词内已有的角色外，按照提示词再帮我生成第{volume_number}卷会用到的{num_characters}个主要角色
请根据上述要求，生成角色状态文档。
"""
# 7.1.2 生成小说后续章节草稿正文时角色状态
create_character_prompt = """\
基于以下元素：
当前小说为{genre}小说共{volume_count}卷，共{num_chapters}章
准备生成小说第{volume_number}卷 第{novel_number}章《{chapter_title}》 字数：{word_number}字
章节定位：{chapter_role}
核心作用：{chapter_purpose}
悬念类型：{suspense_type}
情绪演变：{emotion_evolution}
伏笔条目：
{foreshadowing}
颠覆指数：{plot_twist_level}
章节简述：{chapter_summary}
小说主题：
{topic}
内容指导：
{user_guidance}

前情摘要：
{global_summary}

【上一章剧情要点】
{plot_points}

分卷大纲：
{volume_outline}

角色数据库：
{Character_Database}

1、按照上面所有设定，从角色数据库中提取出本章正文会使用到的角色ID。
2、根据设定，生成本章需要用到新角色，按照格式生成新角色。

要求：
- 角色数据库为空时，无需生成角色ID
- 不要提取与本章正文无关的角色的角色ID
- 仅提取符合设定要求的角色ID
- 如果需要新角色，基于上述所有设定（章节信息、小说主题、内容指导、前情摘要、剧情要点、分卷大纲、角色数据库）按照“新生成角色格式”完整生成。
- 仅提及不会出场的角色信息尽量简洁，并在条目中注明
- 没有出场并不会提及的角色不要生成
- 不要生成重复的角色ID
- 新角色生成时不要与角色数据库内已有的角色重复
- 根据设定，需要生成新角色的，需按照新角色格式生成
- 根据设定，生成角色基础信息，不要出现超出当前章节设定的角色基本信息
- 不要添加任何介绍性文本、标题或章节信息，直接从角色ID开始
- 确保每个角色之间有明确的分隔，不要将一个角色的信息与另一个角色的ID混在一起

新生成角色格式为：（不允许生成数据库内已有角色）
角色名：
基础信息：
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（1-20背景角色，21-40单元角色，41-60次要配角，61-80核心配角，81-95关键角色，96-100主角级）
势力特征：
- 所属组织/势力：学校 / 黑帮 / 公司 / 秘密社团 / 家族 / 政府机构
- 身份：学生 / 雇佣兵 / 程序员 / 街头混混 / 普通职员 / 未知身份者
- 外貌特征：简要描述（如黑发丹凤眼、左臂残缺、常穿连帽衫、戴墨镜等）
- 性格：性格关键词（如机敏多疑、正义冲动、沉稳寡言、社交高手、偏执孤僻）
基本简介：50字以内
示例：
林夏：
基础信息：
- 其他称谓：小夏（亲友用）、阿Lin（别称，同事称呼）、林姐（尊称，下属称呼）、沈安（化名，隐藏身份时使用）
- 角色权重：82（定位：核心配角）
势力特征：
- 所属组织/势力：自由职业者 / 前网络情报员 / 临时加入调查小组
- 身份：独立黑客 / 兼职网络安全顾问 / 失踪案件关注者
- 外貌特征：短发利落，右耳戴单只银色耳钉，常年穿宽松卫衣与牛仔裤
- 性格：冷静理智、逻辑清晰、话少但一针见血，对外界保持高度警惕
基本简介：50字以内

请根据上述要求，生成角色状态文档.
"""

# 7.2 角色名称提取提示词
Character_name_prompt = """\
你是一位专业的文本分析专家，请仔细阅读以下章节内容，提取出所有出现的角色名称。

章节编号：第{novel_number}章
章节标题：《{chapter_title}》

章节内容：
{chapter_text}

请提取出章节中出现的所有角色名称，包括主角、配角、路人等所有人物。
要求：
1. 只输出角色名称，一行一个名称
2. 不要输出角色的描述、分析或其他内容
3. 避免出现相同角色使用不同名称重复生成的情况，避免出现不同称谓但是确是同一角色的情况，张三爷、张哥哥，县令李x、李x，
4. 按照角色在文中出现的重要程度排序
5. 确保不遗漏任何角色

输出格式示例：
张三
李四
王五

请直接输出角色名称列表，不要有任何额外说明。
"""
# 7.3 定稿时的角色状态更新
update_character_state_prompt = """\
当前小说为{genre}小说共{volume_count}卷，共{num_chapters}章
当前章节为第{volume_number}卷 第{novel_number}章《{chapter_title}》
章节定位：{chapter_role}
核心作用：{chapter_purpose}
悬念类型：{suspense_type}
情绪演变：{emotion_evolution}
伏笔条目：
{foreshadowing}
颠覆指数：{plot_twist_level}
章节简述：{chapter_summary}
以下是新完成的章节文本：
{chapter_text}

这是当前的角色状态文档：
{old_state}
检索出的角色与对应编号：
{Character_Database}

请更新角色状态，严格按照以下权重等级生成对应字段：

◆ 权重等级定义（必须严格遵循）：
- [背景角色]（1-20）：仅生成【基础信息 + 位置轨迹】
- [单元角色]（21-40）：生成【基础信息 + 位置轨迹 + 势力特征】
- [次要配角]（41-60）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录】
- [核心配角]（61-80）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网】
- [关键角色]（81-95）：生成【基础信息 + 位置轨迹 + 势力特征 + 关键事件记录 + 生命状态 + 持有物品 + 技术能力 + 关系网 + 行为模式/决策偏好 + 语言风格/对话关键词】
- [主角级]（96-100）：生成所有字段

◆ 字段生成规则（必须严格执行）：
1. 权重≤20：禁止生成势力特征等高级字段
2. 权重≤40：禁止生成关键事件记录等字段
3. 权重≤60：禁止生成生命状态、持有物品字段
4. 权重≤80：禁止生成行为模式/决策偏好字段
5. 权重≤95：禁止生成情感线状态字段
6. 禁止生成当前权重未授权的任何字段

◆ 字段内容规范：
【基础信息】
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（精确数值+括号标注定位）
- 禁用通用称谓：爸/妈/爹/大爷/阿姨等
【关键事件记录】（仅当权重≥21时生成）
- 格式：第X章：[类型] 事件摘要（如"第5章：[战斗] 峡谷遭遇伏击"）
- 生成数量：权重≥90≤5条，其他≤2条
【势力特征】（仅当权重≥41时生成）
- 所属组织/势力：学校/黑帮/公司/秘密社团等
- 身份：学生/雇佣兵/程序员等
- 外貌特征：≤20字简要描述
- 性格：≤3个关键词描述
【生命状态】（仅当权重≥41时生成）
- 身体状态：健康/特殊体质/伤势
- 心理状态：情绪基调/初期动机
- 长期影响：潜在问题/能力
【持有物品】（仅当权重≥41时生成）
- 格式：物品名称：（功能简述）
- 生成数量：同关键事件记录规则
【技术能力】（仅当权重≥41时生成）
- 格式：技能名称：（功能描述）
- 生成数量：同关键事件记录规则
【位置轨迹】（仅当权重≥61时生成）
- 格式：场景名称（时间线：第X章）（事件：摘要）（同行人物）（目的）
- 生成数量：权重≥90≤3条，其他1条
【关系网】（仅当权重≥61时生成）
- 格式：角色名:关系类型,关系强度[低/中/高],互动频率[稀少/普通/频繁]
- 生成数量：同关键事件记录规则
【行为模式/决策偏好】（仅当权重≥81时生成）
- 行为模式：≤10字描述
- 决策偏好：优先级排序（如"自保>探索>结盟"）
【语言风格/对话关键词】（仅当权重≥81时生成）
- 语言风格：≤2个关键词
- 关键词：≤3条常用短句
【情感线状态】（仅当权重≥96时生成）
- 情感线状态：起点阶段描述
- 感情进展标记：【好感度：XX%】【羁绊等级：X】

◆ 角色状态生成：
- 生成的角色编号必须严格按照输出要求格式与“检索出的角色与对应编号”的内容对应生成，如：（编号：角色名称）为（ID0003：苏月璃），顺序不能颠倒，编号不能重复，也不能直接使用（编号）两字代替。
- 角色编号按照检索出的角色对应编号填写至格式内对应角色编号内。
- 其他称谓不要出现：父亲、母亲等通用称谓。
- 权重随着章节推进，权重会逐渐提升或者下降，角色状态会逐渐丰富。

◆ 输出要求：
- 完全禁用当前权重未授权的字段
- 每个字段之间禁止出现空行
- 字段内容为空时返回空值
- 禁止解释/注释/额外文本
- 严格遵循以下格式：
格式：
编号：角色名称
基础信息：
- 其他称谓：...
- 角色权重：...

（根据权重生成后续字段...）

示例：
ID0003：苏月璃
基础信息：
- 其他称谓：...
- 角色权重：...

（根据权重生成后续字段...）

仅返回更新后的角色状态文本，严格按照格式输出，不要解释任何内容。
"""

# =============== 8. 章节正文草稿写作 ===================
chapter_draft_prompt = """
【本章信息】
章节编号：第{novel_number}章《{chapter_title}》字数：{word_number}字
小说类型：{genre}
章节定位：{chapter_role}
核心作用：{chapter_purpose}
悬念类型：{suspense_type}
情绪演变：{emotion_evolution}
伏笔条目：
{foreshadowing}
颠覆指数：{plot_twist_level}
章节简述：{chapter_summary}
关键物品：{key_items}
场景位置：{scene_location}
时间约束：{time_constraint}

【小说主题】
{topic}

【分卷大纲】
{volume_outline}

【角色状态】
{setting_characters}

{characters_involved}

【前情摘要】
{global_summary}

【上一章剧情要点】
{plot_points}

【伏笔历史记录】
{knowledge_context}

【用户指导】
{user_guidance}

【核心任务】
你现在是一位资深小说作家，需根据以下规则创作当前章节正文草稿：
**叙事逻辑强化**  
- **章节锚点**：
   - 对于非跳跃章节：必须严格基于前一章的[剧情要点]结尾触发点（场景残留/时间标记/事件余波）展开，确保无缝衔接。
   - 对于跳跃章节：需通过以下方式构建逻辑桥梁：
     - 时间跳跃 → 引入时间线索（如日记、回忆闪回、年龄变化、季节更替）
     - 空间跳跃 → 借助交通工具、传送机制、梦境/幻觉等自然过渡手段
     - 视角跳跃 → 通过对话、旁白、信件、监控记录等方式建立连接
     - 因果跳跃 → 以悬念式开头引发疑问，随后逐步揭示原因
     - 世界观跳跃 → 使用“认知冲击”或“现实扭曲”作为转场契机（如穿越、觉醒、意识投射）
- **节奏控制**：根据悬念类型和颠覆指数设计情节密度，例如：  
  - 信息差型：通过角色视角的局限性制造认知偏差  
  - 道德抉择型：用角色价值观冲突推动剧情  
  - 倒计时型：插入时间紧迫感的细节（如沙漏、心跳声、天象变化）  
  - 谜题型：通过环境线索（如壁画符号、对话暗示）逐步揭示真相
**角色行为可信度**  
- **动机优先**：角色的所有行动必须与其[角色状态]中的决策偏好、情感线状态和长期影响一致，例如：  
  - 主角在情绪崩溃后不会突然冷静分析，需通过生理反应（颤抖、口吃）过渡  
  - 拥有“童年创伤”的角色在压力下会触发特定防御机制（如逃避/攻击）  
- **对话设计**：  
  - 每个角色的台词需符合其语言风格和关键词（如“闭嘴”“别小看我”）  
  - 关键对话必须推动关系网变化（信任→怀疑/合作→背叛）
  
**特别注意事项**
1. **避免AI痕迹**：
   - 使用自然流畅的语言，避免机械式句式或重复结构
   - 章节内容应具有文学性和代入感，减少生硬的描述
   - 对话要贴近真实人物性格，避免过于刻板或模式化
2. **遵循大纲**：严格按照[分卷大纲]中对本卷及本章的规划（如主题、情节发展、角色任务等）进行创作，确保故事主线不偏离。
3. **角色塑造**：参考[角色状态]中各角色的性格、目标、当前状态和关系网等内容，确保角色言行符合其设定，并通过本章情节推动角色成长或展现其多面性。
4. **世界观一致**：创作时必须严格遵守世界观规则，包括物理法则、社会结构、文化背景等。
5. **情节推进**：本章需完成章节信息中设定的核心作用（如推进主线、制造转折、揭示世界观等）。
6. **用户指导优先**：如果用户额外指导中的内容与上述要点有冲突，优先遵循用户额外指导。
7. **伏笔处理**：按照伏笔条目的内容要求有效埋设、触发、强化或回收伏笔，并衔接对应的伏笔历史记录。
【内容要求】
- **叙事流畅**：运用生动的描写和自然的对话，使故事引人入胜，禁止出现排比句。
- **逻辑严谨**：确保情节发展合乎逻辑，人物动机合理，调理严密，避免出现矛盾或矛盾冲突。
- **语言生动**：语言要直白生动，避免使用过于专业或晦涩的词汇。
- **内容丰富**：在内容上要做到丰富多样，避免出现单一的描写或相同的内容。
- **信息密度**：在推动剧情的同时，适时融入新的信息、悬念或伏笔，保持故事的吸引力。
- **对话要求**：按照角色的性格、身份和状态，合理组织和安排对话内容。
- **内容禁止**：禁止出现伏笔编号、角色编号等元数据标记；禁止出现角色内心独白（如：AF001、YF001、ID0001等编号）。

【格式标准】
1. **段落**：
   - 自然分段，每段不宜过长，一般不超过2-3个完整句子。
   - 环境描写、动作描写、心理描写、对话等可根据需要独立成段，以增强节奏感。
2. **对话**：
   - 对话部分建议每句单独成行，或根据对话节奏灵活处理。
   - 使用规范的对话引号（例如：“你好。”他说道。）
3. **输出**：
   - 输出纯净的章节正文文本。
   - 使用中文全角标点符号。
   - 段落之间不允许出现空行。

仅返回更新后的章节正文文本，禁用Markdown，严格按照格式输出，不要解释任何内容。
"""

# 8.1 伏笔历史记录提取预处理
chapter_draft_knowledge_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_ids}
分析出本章伏笔编号,单独使用伏笔编号作为提示词从向量库检索出伏笔历史内容
  - 伏笔历史内容（从向量库检索）：

格式示例如下：
YF001:
内容：整合后的最新内容1
伏笔最后章节：第{novel_number}章

CF001:
内容：整合后的最新内容2
伏笔最后章节：第{novel_number}章
  
◆ 输出要求：
  - 仅返回最终用于向量化的JSON格式数据。
  - 不要包含任何解释或额外文本。
  - 如果没有相关伏笔内容，返回本章伏笔无历史内容。
"""
# =============== 9. 知识提取、整合与向量化 ===================

# 9.1 伏笔内容提取、整合与向量化提示词
foreshadowing_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》

  - 伏笔历史内容（从向量库检索）：
{foreshadowing_history} 
  
  - 本章伏笔内容（已预处理）：
{current_foreshadowing_content}

◆ 处理流程：

  1. **整合内容**：
     - 使用LLM整合所有内容，输出格式为普通文本。
     - 结合【伏笔历史内容】 和【本章伏笔内容】 。
     - 对每个伏笔编号，生成整合后的最新伏笔描述。
     - 考虑伏笔状态（埋设/触发/强化/回收），确保内容连贯。
     - 最后使用嵌入模型将内容向量化。

  2. **输出与向量化准备**：
     - 输出整合后的伏笔内容。
     - 输出格式（用于后续向量化，需严格遵守）：

YF001:
内容：整合后的最新内容1
伏笔最后章节：第{novel_number}章

CF001:
内容：整合后的最新内容2
伏笔最后章节：第{novel_number}章
...
- 重要: `内容` 字段应包含伏笔的详细描述或最新进展。`伏笔最后章节` 字段必须包含该伏笔最后出现的章节编号。

◆ 输出要求：
  - 仅返回最终用于向量化的普通文本格式数据。
  - 不要包含任何解释或额外文本。
"""


#  9.2 剧情要点提取
plot_points_extraction_prompt = """\
【章节剧情要点任务】

◆ 输入数据：
准备生成小说第{novel_number}章《{chapter_title}》的剧情要点

下一章章节目录：
{next_chapter_outline}

本章章节正文：
{chapter_text}

◆ 解构维度：
环境锚点：
- 主场景：精确到具体建筑/地形特征（如"断崖边的废弃古庙"）
- 氛围要素：天气/光照/特殊现象（如"血色月光笼罩"）
- 时间刻度：具体时辰/季节特征（如"霜降前夜"）
- 场景细节：场景内标志性陈设/地理标识（如"石阶上布满青苔"）
冲突节点（按优先级排序）：
- 主冲突：对抗双方+冲突本质（如"正邪两派争夺上古秘宝"）
- 次冲突：人物间立场/利益碰撞（如"师徒理念分歧爆发"）
- 潜冲突：埋设的潜在矛盾线索（如"体内异火出现反噬征兆"）
状态变更：
- 角色状态：重要角色生死/伤势/能力变化（带章节依据）
- 物品状态：关键道具所有权/完整性变更（如"玄铁剑断裂"）
- 关系状态：人物关系突破性进展（如"盟友→叛徒"）
- 情绪状态：角色情感转折（如"从愤怒转为冷静谋划"）
推进力度：
- 时间推进：本章引发的时间跨度（如"三日后决战将至"）
- 空间坐标：场景转移距离（如"从北境雪原跨越至火山腹地"）
- 矛盾升级：冲突烈度变化等级（如"言语交锋→生死对决"）
- 节奏倾向：高潮收尾/悬而未决/伏笔暗藏
【第{novel_number}章结尾触发点】（用于下一章开头响应）
- 场景残留：章末最后一幕的具体画面（如"古庙废墟中，主角跪地咳血"）
- 时间标记：章末时间节点或时间跳跃提示（如"子时钟声响起，封印松动"）
- 事件余波：本章结尾引发的直接后果（如"异火失控灼烧同伴，众人哗变"）


◆ 输出格式：
第{novel_number}章《{chapter_title}》剧情要点：
【环境锚点】
- 主场景：XXX（精确描述）
- 氛围特征：XXX（视觉/听觉/气候）
- 时间坐标：XXX（具体时段标记）
- 场景细节：XXX
【冲突演进】
- 主冲突：XXX ←→ XXX（矛盾本质）
- 次冲突：XXX 与 XXX（冲突类型）
- 潜冲突：XXX（暗示性线索）

【状态变更】
- 角色层：XXX（状态变化依据）
- 物品层：XXX（变更细节）
- 关系层：XXX（关系转变）
- 情绪层：XXX（情感转折）
【推进指标】
- 时间跨度：+XX日/月/年
- 空间坐标：XX里（具体距离）
- 矛盾烈度：言语交锋→生死对决（Lv.X→Lv.X+1）
- 节奏倾向：高潮/伏笔/转折
【第{novel_number}章结尾触发点】
- 场景残留：XXX（最后一幕画面）
- 时间标记：XXX（时间节点）
- 事件余波：XXX（直接后果）

禁止使用任何格式符号，各模块间用空行分隔，不要添加解释说明。
"""

# 9.3 伏笔历史内容预处理
foreshadowing_history_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_ids}
  - 章节正文：
{chapter_text}
分析出本章伏笔编号,单独使用伏笔编号作为提示词从向量库检索出伏笔历史内容
  - 伏笔历史内容（从向量库检索）：

◆ 输出要求：
  - 请按以下格式输出每个伏笔的历史内容：

YF001:
历史内容：伏笔1的历史内容

CF001:
历史内容：伏笔2的历史内容

...

  - 如果没有历史内容，请注明"无历史内容"
  - 不要包含任何解释或额外文本。
"""

# 9.4 本章伏笔内容的预处理
foreshadowing_content_processing_prompt = """\
【伏笔内容处理任务】

◆ 输入数据：
  - 章节编号：第{novel_number}章《{chapter_title}》
  - 本章涉及伏笔编号列表：
{foreshadowing_ids}
  - 章节正文：
{chapter_text}
分析出本章伏笔简介,使用伏笔简介作为提示词从本章正文中使用LLM提取伏笔正文，每条伏笔提取到正文不超过500字

◆ 输出要求：
  - 请按以下格式输出每个伏笔的本章内容：

YF001:
本章内容：伏笔1在本章的内容描述（不超过500字）

CF001:
本章内容：伏笔2在本章的内容描述（不超过500字）

...

  - 如果本章没有某伏笔的内容，请注明"本章无相关内容"
  - 不要包含任何解释或额外文本。
"""


# =============== 10、小说分卷设计（分卷提示词） ===================
volume_design_format = """\
请以严谨的文学结构与叙事逻辑，生成分卷大纲。要求内容具有张力、悬念与成长弧线，并体现世界观的独特性。

输出要求：
- 使用清晰的标题与层级结构
- 所有提示中提到的角色都需在大纲中出现
- 语言简洁凝练，富有画面感与节奏感

以下是需要包含的大纲结构，请严格按照顺序完成：

━━━━━━━━━━━━━━━━━━━━
📘 第x卷《卷名》 分卷大纲
━━━━━━━━━━━━━━━━━━━━
一、卷名与主题
1. 【卷名】：请为本卷命名，体现核心冲突或关键转折点。
2. 【核心主题】：用一句话概括本卷的核心命题。
3. 【次要主题】：列出1-2个次要主题或变奏主题。
4. 【主题载体】：指出承载主题的具体象征物、场景或事件。
二、世界观展开
1. 【重点维度】：请选择并说明本卷聚焦的世界观层面：
   - 物理维度（地理、科技、生态等）
   - 社会维度（制度、文化、权力结构等）
   - 隐喻维度（信仰、神话、命运机制等）
2. 【揭示节点】：列出3-5个关键事件或场景，用于逐步展现世界观。
   - 每个节点需说明揭示了什么、如何推动剧情发展。
3. 【角色与世界的互动】：
   - 描述角色如何因世界观限制而做出选择
   - 反映世界观如何影响角色的成长与冲突
三、情节架构
1. 【起始事件】：打破原有平衡的关键事件，引出主线。
2. 【发展阶段】：列出3-5个关键转折事件，形成递进式冲突。
3. 【高潮设计】：设计本卷最高潮场景，融合世界观特性与角色抉择。
4. 【收尾悬念】：留下1-2个未解之谜或新危机，作为下一卷铺垫。
四、角色发展
1. 【成长轨迹】：为每个主要角色设计成长弧线：
   - 初始状态 → 转折事件 → 卷末状态
   - 示例格式：
     - [角色A]：[初始性格/信念] → [触发事件] → [转变结果]
     - [角色B]：...
2. 【关系变化】：列出重要角色之间的关系演变：
   - 如从敌对到合作、信任破裂、情感升温等
3. 【互动设计】：
   - 每个角色与其他角色之间的重要互动
   - 每个角色与环境/规则/系统的对抗或适应
五、章节分布
1. 【章节范围】：列出本卷包含的章节编号（如第1~20章）。
2. 【集群划分】：
   - 奠基组（引入设定与角色）
   - 发展组（冲突升级与世界扩展）
   - 高潮组（最终爆发与悬念设置）
   - （可根据实际需要增删）
3. 【每组功能与重点】：
   - 说明该组章节的核心作用（如建立世界观、引发冲突、展示角色成长）
   - 指出该组对应的重点世界观维度或主题表现
六、附加说明（可选）
- 风格参考：是否希望偏向史诗感、悬疑风、热血向等？
- 重点强调：是否有特别想突出的元素（如战斗系统、爱情线、政治博弈等）？

请确保所有提示中提及的角色均被纳入角色发展与互动设计中。
"""

volume_outline_prompt = """\
   请根据以下小说基础信息与设定，生成第1卷的完整分卷大纲：

【小说基本信息】
- 类型：{genre}
- 总卷数：{Total_volume_number}卷
- 总章数：{number_of_chapters}章
- 单章字数：{word_number}字

【创作要素】
- 主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 主要角色：
{setting_characters}

{character_state}

{characters_involved}

请严格按照以下格式生成第1卷大纲，
{volume_design_format} 

要求：
- 所有角色需出现在角色发展与互动设计中
- 世界观需通过事件与角色决策自然揭示
- 高潮场景需融合核心主题与世界观特性
- 收尾悬念需为后续卷埋下伏笔

禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

subsequent_volume_prompt = """\
基于以下元素生成第{volume_number}卷分卷大纲：
- 类型：{genre}
- 总卷数：{Total_volume_number}卷
- 总章数：{number_of_chapters}章
- 单章字数：{word_number}字
【小说基础信息】
- 主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 前卷大纲：{previous_volume_outline}
- 主要角色：
{setting_characters}

{characters_involved}

 需额外满足：
1. 世界观深化：
   - 新增1-2个维度或对前卷维度的冲突升级
   - 世界观规则对情节的限制与推动设计（2-3个节点）
2. 情节架构：
   - 需解决前卷悬念并衔接世界观解释
   - 本卷核心冲突需与新增世界观维度绑定
3. 角色发展：
   - 主要角色需因世界观变化产生价值观冲突
   - 关系变化需推动主线矛盾发展
4. 章节分布：
   - 需体现世界观维度的递进揭示节奏
   - 章节集群功能需与前后卷形成叙事呼应

请严格按照如下格式生成第{volume_number}卷《[卷名]》的大纲：
{volume_design_format}

禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

final_volume_prompt = """\
基于以下元素生成最终卷（第{volume_number}卷）分卷大纲：
- 类型：{genre}
- 总卷数：{Total_volume_number}卷
- 总章数：{number_of_chapters}章
- 单章字数：{word_number}字
【小说基础信息】
- 主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 角色状态：{character_state}
- 核心人物：{characters_involved}
- 前卷大纲：{previous_volume_outline}

需额外满足：
1. 世界观收束：
   - 所有世界观维度的最终解释与融合
   - 核心世界观规则的最终呈现与应用
2. 情节架构：
   - 解决所有前卷悬念与伏笔
   - 主线冲突达到最高潮并完成解决
3. 角色发展：
   - 所有主要角色的命运最终走向
   - 核心角色关系的最终定位与结局
4. 章节分布：
   - 高潮与结局的合理节奏安排
   - 留下恰当的开放性与想象空间

请严格按照如下格式生成终章（第{volume_number}卷）《[卷名]》的大纲：
{volume_design_format}

禁用Markdown，严格按照格式输出，仅返回大纲文本，不要解释任何内容。
"""

# =============== 11. 章节改写与扩写提示词 ====================
chapter_rewrite_prompt = """\
你是专业的小说编辑与创意写作助手。我将提供一章小说草稿，请你根据以下完整设定进行高质量的润色、改写与扩写 ：

【本章信息】

章节编号：第 {novel_number} 章《{chapter_title}》
目标字数：约 {word_number} 字
小说类型：{genre}
章节定位：{chapter_role}
核心作用：{chapter_purpose}
悬念类型：{suspense_type}
情绪演变：{emotion_evolution}
伏笔条目：
{foreshadowing}
颠覆指数：{plot_twist_level}
章节简述：{chapter_summary}
【用户指导】
{user_guidance}

【分卷大纲】
{volume_outline}

【前情摘要】
{global_summary}
【改写建议】
{一致性审校}

【原始草稿】
{raw_draft}

请你根据以上信息完成以下任务：
字数控制 ：请将本章扩写至约 {word_number} 字左右，并在完成后注明当前实际字数。
润色与改写 ：优化语言表达，增强描写细节，使人物对话更自然、情节更具吸引力。
扩写内容 ：在不偏离原意的前提下，丰富场景描写、心理活动、背景设定等，适当增加次要情节或互动，使故事更饱满。
风格保持 ：请严格保持原文的叙述风格、语气、人称视角和世界观设定。
情绪匹配 ：确保章节的情绪演变路径清晰，符合情绪演变。

【核心任务】
你现在是一位资深小说作家，需根据以下规则创作当前章节正文草稿：
**叙事逻辑强化**  
- **章节锚点**：
   - 对于非跳跃章节：必须严格基于前一章的[剧情要点]结尾触发点（场景残留/时间标记/事件余波）展开，确保无缝衔接。
   - 对于跳跃章节：需通过以下方式构建逻辑桥梁：
     - 时间跳跃 → 引入时间线索（如日记、回忆闪回、年龄变化、季节更替）
     - 空间跳跃 → 借助交通工具、传送机制、梦境/幻觉等自然过渡手段
     - 视角跳跃 → 通过对话、旁白、信件、监控记录等方式建立连接
     - 因果跳跃 → 以悬念式开头引发疑问，随后逐步揭示原因
     - 世界观跳跃 → 使用“认知冲击”或“现实扭曲”作为转场契机（如穿越、觉醒、意识投射）
- **节奏控制**：根据悬念类型和颠覆指数设计情节密度，例如：  
  - 信息差型：通过角色视角的局限性制造认知偏差  
  - 道德抉择型：用角色价值观冲突推动剧情  
  - 倒计时型：插入时间紧迫感的细节（如沙漏、心跳声、天象变化）  
  - 谜题型：通过环境线索（如壁画符号、对话暗示）逐步揭示真相
**角色行为可信度**  
- **动机优先**：角色的所有行动必须与其[角色状态]中的决策偏好、情感线状态和长期影响一致，例如：  
  - 主角在情绪崩溃后不会突然冷静分析，需通过生理反应（颤抖、口吃）过渡  
  - 拥有“童年创伤”的角色在压力下会触发特定防御机制（如逃避/攻击）  
- **对话设计**：  
  - 每个角色的台词需符合其语言风格和关键词（如“闭嘴”“别小看我”）  
  - 关键对话必须推动关系网变化（信任→怀疑/合作→背叛）
  
**特别注意事项**
1. **避免AI痕迹**：
   - 使用自然流畅的语言，避免机械式句式或重复结构
   - 章节内容应具有文学性和代入感，减少生硬的描述
   - 对话要贴近真实人物性格，避免过于刻板或模式化
2. **遵循大纲**：严格按照[分卷大纲]中对本卷及本章的规划（如主题、情节发展、角色任务等）进行创作，确保故事主线不偏离。
3. **角色塑造**：参考[角色状态]中各角色的性格、目标、当前状态和关系网等内容，确保角色言行符合其设定，并通过本章情节推动角色成长或展现其多面性。
4. **世界观一致**：创作时必须严格遵守世界观规则，包括物理法则、社会结构、文化背景等。
5. **情节推进**：本章需完成章节信息中设定的核心作用（如推进主线、制造转折、揭示世界观等）。
6. **用户指导优先**：如果用户额外指导中的内容与上述要点有冲突，优先遵循用户额外指导。
7. **伏笔处理**：按照伏笔条目的内容要求有效埋设、触发、强化或回收伏笔，并衔接对应的伏笔历史记录。
【内容要求】
- **叙事流畅**：运用生动的描写和自然的对话，使故事引人入胜，禁止出现排比句。
- **逻辑严谨**：确保情节发展合乎逻辑，人物动机合理，调理严密，避免出现矛盾或矛盾冲突。
- **语言生动**：语言要生动活泼，避免使用过于专业或晦涩的词汇。
- **内容丰富**：在内容上要做到丰富多样，避免出现单一的描写或相同的内容。
- **信息密度**：在推动剧情的同时，适时融入新的信息、悬念或伏笔，保持故事的吸引力。
- **对话要求**：按照角色的性格、目标和状态，合理组织和安排对话内容。
- **内容禁止**：禁止出现伏笔编号、角色编号等元数据标记；禁止出现角色内心独白。

【格式标准】
1. **段落**：
   - 自然分段，每段不宜过长，一般不超过2-3个完整句子。
   - 环境描写、动作描写、心理描写、对话等可根据需要独立成段，以增强节奏感。
2. **对话**：
   - 对话部分建议每句单独成行，或根据对话节奏灵活处理。
   - 使用规范的对话引号（例如：“你好。”他说道。）
3. **输出**：
   - 输出纯净的章节正文文本。
   - 使用中文全角标点符号。
   - 段落之间不允许出现空行。

仅返回更新后的章节正文文本，禁用Markdown，严格按照格式输出，仅返回扩写文本，不要解释任何内容。
"""

# =============== 12. 一致性审校提示词 ====================
Chapter_Review_prompt = """
【章节信息】
章节编号：第 {novel_number} 章《{chapter_title}》
目标字数：约 {word_number} 字
小说类型：{genre}
章节定位：{chapter_role}
核心作用：{chapter_purpose}
悬念类型：{suspense_type}
情绪演变：{emotion_evolution}
颠覆指数：{plot_twist_level}
章节简述：{chapter_summary}

【用户指导】
{user_guidance}

【分卷大纲】
{volume_outline}

【前情摘要】
{global_summary}

【上一章剧情要点】
{plot_points}

【基础信息验证】
- 当前章节是否符合{genre}类型特征？
- 是否符合本章定位与核心作用？

【叙事连贯性检查】
- 情节发展是否与前情摘要和上一章剧情要点形成有效衔接？
- 情绪曲线是否在正文中得到体现？
- 角色行为是否符合设定？
- 世界观设定是否一致？
- 悬念演变类型的悬念设置是否存在逻辑漏洞？

【伏笔追踪系统】
本章伏笔设计：
{foreshadowing}

历史伏笔记录：
{knowledge_context}

- 当前伏笔处理是否符合伏笔设计原则
- 当前伏笔处理是否与伏笔记录形成有效衔接？
【颠覆性评估】
- {plot_twist_level}级反转是否与伏笔记录匹配？
- 章节简述{chapter_summary}是否准确概括正文内容？

【冲突预警】
▶ 若存在矛盾或未闭环伏笔，请按[冲突类型][具体位置][修正建议]格式列出
▶ 若无异常，请返回"无明显冲突"

请以审校官身份输出结论，重点标注：❗伏笔异常❗情绪断层❗类型偏移❗

按照上面的设定，请对以下章节内容进行结构化审校：
==需审校内容开始==：
{Review_text}
==需审校内容结束==：
(禁用Markdown，严格按照格式输出，仅返回内容，不要解释任何内容。)
"""

# =============== 13. 角色库（分析文本，解析出角色)===================
Character_Import_Prompt = """

请提取文本内的所有角色状态，角色状态格式字段分为：

严格要求：
- 必须直接从角色名开始，不要添加任何介绍性文本、标题或章节信息
- 每个角色必须严格按照以下格式：角色名单独一行，后跟冒号，然后是换行
- 每个角色之间必须有明确的分隔，不要将一个角色的信息与另一个角色混在一起
- 严格按照示例格式输出，保持相同的缩进和标点符号
- 所有字段必须完整填写，不要省略任何字段
- 角色名必须单独一行，后面紧跟冒号，不要添加其他内容
- 确保每个角色的格式完全一致，便于系统解析

角色格式为：
角色名：
基础信息：
- 其他称谓：别称（来源）、小名（亲友用）、尊称（官方/他人称呼）、化名（隐藏身份时使用）
- 角色权重：1-100（1-20背景角色，21-40单元角色，41-60次要配角，61-80核心配角，81-95关键角色，96-100主角级）
势力特征：
- 所属组织/势力：学校 / 黑帮 / 公司 / 秘密社团 / 家族 / 政府机构
- 身份：学生 / 雇佣兵 / 程序员 / 街头混混 / 普通职员 / 未知身份者
- 外貌特征：简要描述（如黑发丹凤眼、左臂残缺、常穿连帽衫、戴墨镜等）
- 性格：性格关键词（如机敏多疑、正义冲动、沉稳寡言、社交高手、偏执孤僻）
生命状态：
- 身体状态：健康 / 受伤 / 特殊体质（具体说明状况）
- 心理状态：情绪基调 / 初期动机（具体说明状况）
- 长期影响：潜在问题或能力（具体说明状况）
基本简介：50字以内

示例：
林夏：
基础信息：
- 其他称谓：小夏（亲友用）、阿Lin（别称，同事称呼）、林姐（尊称，下属称呼）、沈安（化名，隐藏身份时使用）
- 角色权重：82（定位：核心配角）
势力特征：
- 所属组织/势力：自由职业者 / 前网络情报员 / 临时加入调查小组
- 身份：独立黑客 / 兼职网络安全顾问 / 失踪案件关注者
- 外貌特征：短发利落，右耳戴单只银色耳钉，常年穿宽松卫衣与牛仔裤
- 性格：冷静理智、逻辑清晰、话少但一针见血，对外界保持高度警惕
生命状态：
- 身体状态：健康，长期熬夜导致轻微贫血，右手腕有旧伤
- 心理状态：表面冷静，内心焦虑，寻找失踪好友的真相
- 长期影响：童年经历网络诈骗，对网络安全有执念，擅长追踪数据
基本简介：技术天才，性格孤僻，为寻找失踪好友而加入调查，擅长信息收集与数据分析。

请根据上述要求，生成角色状态文档。不要添加任何额外的解释或说明，直接输出角色信息。每个角色必须严格按照示例格式输出，确保系统能正确解析。不要添加任何额外的解释或说明，直接输出角色信息。
"""
# prompt_definitions.py
# -*- coding: utf-8 -*-
"""
**除带大括号（变量）外的提示词都可修改。**
**除带大括号（变量）外的提示词都可修改。**
**除带大括号（变量）外的提示词都可修改。**
集中存放所有提示词 (Prompt)，整合雪花写作法、角色弧光理论、悬念三要素模型等
并包含新增加的前三章摘要/下一章关键字提炼提示词，以及章节正文写作提示词。
"""

# =============== 生成草稿提示词当前章节摘要、知识库提炼 ===============
# 当前章节摘要生成提示词
summarize_recent_chapters_prompt = """\
作为一名专业的小说编辑和知识管理专家，正在基于已完成的前三章内容和本章信息生成当前章节的精准摘要。请严格遵循以下工作流程：
◆ 输入源：
  历史文本｜{combined_text}（前3章内容）
  本章基因｜
  当前章节信息：
  ├──第{novel_number}章《{chapter_title}》
  ├──叙事定位：{chapter_role} 
  ├──核心功能：{chapter_purpose}
  ├──转折强度：{plot_twist_level}
  └──情感谱系：{emotion_evolution}

◆ 分析框架：
□ 传承要素：
  1. 基石设定：<提取前3章必须延续的3个核心元素>
  2. 动态变量：<识别2个允许调整的辅助元素>
  
□ 冲突检测：
  [!] 硬冲突点：<直接违背前文设定的内容>
  [?] 待解释点：<需要补充逻辑衔接的内容>

□ 未来接口：
  次章适配｜需预留{next_chapter_foreshadowing}的3个切入点
  长期伏线｜需保持与{volume_outline}主线70%以上契合度

【生成规范】
▷ 结构要求：
  1. 三段式架构：
    传承段：必须包含<基石设定1>+<动态变量1>
    演进段：实现{chapter_purpose}核心功能
    过渡段：为{next_chapter_title}建立2个叙事支点
  2. 内容密度：
    - 每100字包含1个前文呼应点
    - 新元素占比≤30%（按语义单元统计）

▷ 质量保障：
  1. 一致性检测：
    - 与前文关键设定重复率＜40%
    - 角色行为动机偏差＜15%
  2. 扩展性检测：
    - 确保环境设定变化幅度＜世界观兼容阈值
    - 情感演变符合{emotion_evolution}曲线

【输出模板】
当前章节摘要: <
  采用"传承-演进-过渡"结构：
  基于<基石设定2>，{characters_involved}面临（核心冲突）→ 
  通过<动态变量2>实现（关键转折）→ 
  导致（过渡段结果）并触发{next_chapter_foreshadowing}
  [!] 需处理：<硬冲突点>
  可选方向：<路径A>或<路径B>
>
（严格控制在700-800字，禁用任何格式标记）
"""

# 知识库相关性检索提示词
knowledge_search_prompt = """\
【智能检索矩阵】
◆ 输入维度：
  - 第{novel_number}章《{chapter_title}》
  - 章节定位：{chapter_role}
  - 核心目标：{chapter_purpose}（优先级1）
  - 伏笔需求：{foreshadowing}（优先级2）
  - 环境参数：{scene_location}（权重0.3）
  - 角色状态：{character_state}（权重0.2）
  - 前文摘要：{global_summary}（权重0.1）

◆ 关键词生成：
  1. 核心提取：
    IF {user_guidance}存在 THEN
      提取指导中的核心概念×3
    ELSE 
      从{key_items}提取最具扩展性名词×2
    
  2. 维度组合：
    将核心词与下列属性交叉：
    - 状态变化（突变/衰减/异化）
    - 关系模式（传承/背叛/共生）
    - 时空特征（循环/裂变/沉淀）
    
  3. 过滤机制：
    - 去重：与前3章关键词相似度＞50%自动过滤
    - 聚焦：保留可作用于{characters_involved}的词汇

【输出规范】
检索词组：
1. [核心概念A]+[属性]X（关联强度●●●）
2. [核心概念B]+[属性Y]（关联强度●●○）
3. [环境要素]+[状态变化]（关联强度●○○）
（每组用·分隔，严格3行）
"""

# 知识库内容过滤提示词
knowledge_filter_prompt = """\
【多级内容筛】
◆ 输入流：
  {retrieved_texts}
  
◆ 过滤流程：
□ 第一层：基础过滤
  - 第{novel_number}章《{chapter_title}》
  - 硬冲突：直接删除与{global_summary}矛盾内容
  - 软冲突：标记▲需适配{chapter_role}的内容
  - 重复内容：保留差异度＞60%的部分

□ 第二层：价值分级
  ★★★ 核心素材：（权重1.0）
    - 提供≥2个情节扩展节点
    - 包含可用于{chapter_purpose}的隐喻原型
    - 符合{volume_outline}长期发展需求
  
  ★★ 优质素材：（权重0.6）
    - 增强{emotion_evolution}的情感要素
    - 完善{scene_location}的环境细节
    - 与{character_state}形成互动
  
  ★ 待加工素材：（权重0.3）
    - 需要实例化到{key_items}的抽象概念
    - 可用于丰富世界观细节

□ 第三层：叙事适配
  分类存储：
  [情节引擎]→驱动{chapter_purpose}的核心燃料
    ★★★素材，部署在章节前1/3
  
  [情感催化剂]→强化{emotion_evolution}转折
    ★★素材，插入情感转折点
  
  [环境调色板]→丰富{scene_location}维度
    ★素材，分散融入场景描写

【输出格式】
[分类标签] (价值等级)
→ 植入位置：<建议章节段落>
→ 加工要求：<适配修改提示>
[处理后的内容]

示例：
[情节引擎] (★★★)
→ 植入位置：本章第二个冲突场景
→ 加工要求：需关联{characters_involved}的过往经历
家族徽章暗层发现
"""

# =============== 1. 核心种子设定（雪花第1层）===================
core_seed_prompt = """\
作为专业作家，请用"雪花写作法"第一步构建故事核心：
主题：{topic}
类型：{genre}
篇幅：约{number_of_chapters}章（每章{word_number}字）

请用单句公式概括故事本质，例如：
"当[主角]遭遇[核心事件]，必须[关键行动]，否则[灾难后果]；与此同时，[隐藏的更大危机]正在发酵。"

要求：
1. 必须包含显性冲突与潜在危机
2. 体现人物核心驱动力
3. 暗示世界观关键矛盾
4. 使用25-100字精准表达

仅返回故事核心文本，不要解释任何内容。
"""

# =============== 2. 角色动力学设定（角色弧光模型）===================
character_dynamics_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心种子：{core_seed}

请设计3-6个具有动态变化潜力的核心角色，每个角色需包含：
特征：
- 背景、外貌、性别、年龄、职业等
- 暗藏的秘密或潜在弱点(可与世界观或其他角色有关)

核心驱动力三角：
- 表面追求（物质目标）
- 深层渴望（情感需求）
- 灵魂需求（哲学层面）

角色弧线设计：
初始状态 → 触发事件 → 认知失调 → 蜕变节点 → 最终状态

关系冲突网：
- 与其他角色的关系或对立点
- 与至少两个其他角色的价值观冲突
- 一个合作纽带
- 一个隐藏的背叛可能性

要求：
仅给出最终文本，不要解释任何内容。
"""

# =============== 3. 世界构建矩阵（三维度交织法）===================
world_building_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心冲突："{core_seed}"

为服务上述内容，请构建三维交织的世界观：

1. 物理维度：
- 时代背景：
- 朝代特征与制度：
- 空间结构（地理×社会阶层分布图）
- 时间轴（关键历史事件年表）
- 法则体系（物理/魔法/社会规则的漏洞点）

2. 社会维度：
- 社会文化特点：
- 势力分布：
- 风土人情：
- 权力结构断层线（可引发冲突的阶层/种族/组织矛盾）
- 文化禁忌（可被打破的禁忌及其后果）
- 经济命脉（资源争夺焦点）

3. 隐喻维度：
- 贯穿全书的视觉符号系统（如反复出现的意象）
- 氣候/环境变化映射的心理状态
- 建筑风格暗示的文明困境

要求：
每个维度至少包含3个可与角色决策产生互动的动态元素。
仅给出最终文本，不要解释任何内容。
"""

# =============== 4. 情节架构（三幕式悬念）===================
plot_architecture_prompt = """\
基于以下元素：
- 主题：{topic}
- 内容指导：{user_guidance}
- 核心种子：{core_seed}
- 角色体系：{character_dynamics}
- 世界观：{world_building}

要求按以下结构设计：
第一幕（触发） 
- 日常状态中的异常征兆（3处铺垫）
- 引出故事：展示主线、暗线、副线的开端
- 关键事件：打破平衡的催化剂（需改变至少3个角色的关系）
- 错误抉择：主角的认知局限导致的错误反应

第二幕（对抗）
- 剧情升级：主线+副线的交叉点
- 双重压力：外部障碍升级+内部挫折
- 虚假胜利：看似解决实则深化危机的转折点
- 灵魂黑夜：世界观颠覆指数时刻

第三幕（解决）
- 代价显现：解决危机必须牺牲的核心价值
- 嵌套转折：至少包含三层颠覆指数（表面解→新危机→终极抉择）
- 余波：留下2个开放式悬念因子

每个阶段需包含3个关键转折点及其对应的伏笔回收方案。
仅给出最终文本，不要解释任何内容。
"""

# =============== 5. 章节目录生成（分卷悬念节奏曲线）===================

chapter_blueprint_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 小说架构：
{novel_architecture}
- 分卷大纲：
{volume_outline}

需要生成第1卷（第{x}章至第{y}章）的章节目录，

当前已有章节目录（若为空则说明是初始生成）：\n
{chapter_list}

现在请设计第{n}章到第{m}章的节奏分布：
1. 章节集群构建规则：
- 每3-5章形成叙事单元，必须对应分卷大纲的阶段性目标
- 节奏模板：采用"2紧张+1缓冲"的循环模式
- 重大转折前需有3章以上的多视角铺垫

2. 单章要素规范：
- 本章定位（三选一）：角色成长节点/关键事件推进/世界观揭示
- 悬念类型标注（必选）：信息差型/道德抉择型/倒计时型/谜题型
- 情绪演变路径（示例：焦虑→震惊→坚定）
- 伏笔生命周期标注（新埋设/已触发/待回收）
- 颠覆指数指数（1-5级，3级以上需标注颠覆源）

3. 输出模板：
第X章 [标题]
├─本章定位：
├─核心作用：（推进主线/制造转折/解密/人物塑造）
├─悬念类型：信息差型/道德抉择型/倒计时型/谜题型
├─情绪演变：示例：焦虑→震惊→坚定
├─伏笔操作：（编号+类型+关键对象）
├─颠覆指数：Lv.X 
└─本章简述：（严格≤75字）

4. 执行要求：
- 必须按章节顺序连续生成，禁止跳章
- 每个叙事单元需达成大纲标注的阶段性目标
- 世界观展现必须匹配分卷大纲的进度要求
- 悬念曲线需呈现波浪式递进
- 当上下文不足时立即停止在最后可生成章节

5. 禁止事项：
- 严禁添加示例外的任何文本
- 禁止解释性内容
- 禁止脱离大纲的即兴创作
- 禁用Markdown
- 禁止在章节名前添加任意符号哦字符
"""

chunked_chapter_blueprint_prompt = """\
基于以下元素：
- 内容指导：{user_guidance}
- 小说架构：
{novel_architecture}
- 分卷大纲：
{volume_outline}

需要生成第{volume_number}卷（第{x}章至第{y}章）的章节目录，

当前已有章节目录（若为空则说明是初始生成）：\n
{chapter_list}

现在请设计第{n}章到第{m}章的节奏分布：
1. 章节集群构建规则：
- 每3-5章形成叙事单元，必须对应分卷大纲的阶段性目标
- 节奏模板：采用"2紧张+1缓冲"的循环模式
- 重大转折前需有3章以上的多视角铺垫

2. 单章要素规范：
- 本章定位（三选一）：角色成长节点/关键事件推进/世界观揭示
- 悬念类型标注（必选）：信息差型/道德抉择型/倒计时型/谜题型
- 情绪演变路径（示例：焦虑→震惊→坚定）
- 伏笔生命周期标注（新埋设/已触发/待回收）
- 颠覆指数指数（1-5级，3级以上需标注颠覆源）

3. 输出模板：
第X章 [标题]
├─本章定位：
├─核心作用：（推进主线/制造转折/解密/人物塑造）
├─悬念类型：信息差型/道德抉择型/倒计时型/谜题型
├─情绪演变：示例：焦虑→震惊→坚定
├─伏笔操作：（编号+类型+关键对象）
├─颠覆指数：Lv.X
└─本章简述：（严格≤75字）

4. 执行要求：
- 必须按章节顺序连续生成，禁止跳章
- 每个叙事单元需达成大纲标注的阶段性目标
- 世界观展现必须匹配分卷大纲的进度要求
- 悬念曲线需呈现波浪式递进
- 当上下文不足时立即停止在最后可生成章节

5. 禁止事项：
- 严禁添加示例外的任何文本
- 禁止解释性内容
- 禁止脱离大纲的即兴创作
- 禁用Markdown
- 禁止在章节名前添加任意符号字符
"""

# =============== 6. 前文摘要更新 ===================
summary_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的前文摘要（可为空）：
{global_summary}

请根据本章新增内容，更新前文摘要。
要求：
- 保留既有重要信息，同时融入新剧情要点
- 以简洁、连贯的语言描述全书进展
- 客观描绘，不展开联想或解释
- 总字数控制在2000字以内

仅返回前文摘要文本，不要解释任何内容。
"""

# =============== 7. 角色状态更新 ===================
create_character_state_prompt = """\
依据当前角色动力学设定：{character_dynamics}

请生成一个角色状态文档，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

新出场角色：
- (此处填写未来任何新增角色或临时出场人物的基本信息)

要求：
仅返回编写好的角色状态文本，不要解释任何内容。
"""

update_character_state_prompt = """\
以下是新完成的章节文本：
{chapter_text}

这是当前的角色状态文档：
{old_state}

请更新主要角色状态，内容格式：
例：
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
├──触发或加深的事件
│  ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
│  └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍

角色名：
├──物品:
│  ├──某物(道具)：描述
│  └──XX长剑(武器)：描述
│   ...
├──能力
│  ├──技能1：描述
│  └──技能2：描述
│   ...
├──状态
│  ├──身体状态：
│  └──心理状态：描述
│    
├──主要角色间关系网
│  ├──李四：描述
│  └──王二：描述
│   ...
├──触发或加深的事件
│  ├──事件1：描述
│  └──事件2：描述
    ...

......

新出场角色：
- 任何新增角色或临时出场人物的基本信息，简要描述即可，不要展开，淡出视线的角色可删除。

要求：
- 请直接在已有文档基础上进行增删
- 不改变原有结构，语言尽量简洁、有条理

仅返回更新后的角色状态文本，不要解释任何内容。
"""

# =============== 8. 章节正文草稿写作 ===================

# 8.1 第一章草稿提示
first_chapter_draft_prompt = """\
【世界构建】
◆ 第{novel_number}章《{chapter_title}》
◆ 初始锚点：
  世界观基石｜{novel_setting}
  分卷大纲｜{volume_outline}

◆ 启动参数：
  情绪基线｜[情绪演变首阶段] 
  （要求：情绪演变需用→分隔，如"困惑→觉醒→坚定"）
  节奏设定｜{suspense_type}×{plot_twist_level}
  空间维度｜{scene_location}⊗{time_constraint}

【创世元素】
□ 世界观锚定： 
  核心规则｜从小说设定 提取3个最基础法则
  象征系统｜设计2-3个贯穿全文的意象
  空间定位｜{scene_location}的三维呈现（物理/社会/心理）

□ 创生角色：
  其他角色｜{characters_involved} 
  特质载体｜{key_items}（赋予30%隐藏属性）

□ 原初冲突：
  本章简述｜{chapter_summary}
  结构规范：
  - 必须用→分隔为"起→承"两段式结构
  - 示例："宴会遇袭→发现密道"
  冲突深化｜{chapter_purpose}（嵌入在"承"阶段）

□ 规则播种：
  现世伏笔｜{foreshadowing}（初始强度■■■□）
  次元预埋｜[分卷核心悬念]（关联度▲△△）

【创世法则】
▷ 叙事基准：
  1. 遵循{user_guidance}，确立{chapter_role}基调
  2. 符号密度：1/150字（世界观元素）
  3. 对话权力差 ≥3:1（长度比）

▷ 禁忌领域：
  ✖ 禁止直述：[基础设定列表] 

▷ 创生要求：
  - 三维动作场景（感官维度≥5）
  - 价值天平失衡（其他角色）
  - 环境双重映射（物理+心理）

【次元接口】
⇒ 世界观渗透：2处 小说设定 元素自然融入
⇒ 悬念初始化：[分卷首个转折点]埋设

生成{word_number}字创世篇章，达成：
1. {chapter_purpose}（完成度≥80%）
2. 角色可成长性验证通过
3. 空间透视转换（宏观→微观→异常）
4. 动态张力源≥场景数

（纯文本叙事，禁用格式标记）"""


# 8.2 后续章节草稿提示
next_chapter_draft_prompt = """\
【创作蓝图】
◆ 第{novel_number}章《{chapter_title}》
   章节简述：{chapter_summary}
   分卷大纲｜{volume_outline}
◆ 时空锚点：
  前情提要｜{global_summary}
  前章收束｜{previous_chapter_excerpt}

◆ 核心参数：
  情绪曲线｜{emotion_evolution} → {next_emotion_evolution}
  节奏密度｜{suspense_type}×{plot_twist_level}
  场景坐标｜{scene_location}@{time_constraint}

【要素矩阵】
□ 角色状态：
  {character_state} 
  关键交互｜{characters_involved}在{key_items}影响下的{chapter_purpose}

□ 情节引擎：
  核心冲突｜{short_summary} 
  结构组件要求：
  - 当前章节须含"起→承→转"三段式发展
  - 下一章开头需自然承接当前章结尾
  示例：
  ✓ 合格结构："谈判破裂→秘密转移→遭遇伏击" 
  ✗ 不合格结构："多方势力陷入混战"

□ 悬念架构：
  现章伏笔｜{foreshadowing}（埋设强度：★★★）
  次章预埋｜{next_chapter_foreshadowing}（关联度：▲▲△）

【创作约束】
▷ 叙事准则：
  1. 采用{user_guidance}风格，{chapter_role}定位
  2. 每200字包含1处动态描写（动作/环境变化）
  3. 对话占比控制在30%-40%

▷ 禁忌边界：
  ✖ 禁止出现：{global_summary}  中的已解决冲突
  ✖ 规避重复：{filtered_context}  中的禁忌项

▷ 创新要求：
  至少运用2种写作技法类知识
  在{scene_location}场景中创新使用1项 设定资料类 元素

【衔接规范】
⇒ 前章呼应：需呼应{previous_chapter_excerpt}  中最后3个叙事要素
⇒ 次章预启：在结尾段自然带出{next_chapter_suspense_type}型悬念

生成{word_number}字正文，严格遵循：
1. 当前章节摘要的因果链
2. 分卷大纲的阶段目标
3. 角色行为的动机一致性
4. 环境描写的多感官渗透

（禁用Markdown，纯文本连续书写，段落间空行分隔）
"""
# =============== 9. 角色库（分析文本，解析出角色)===================
Character_Import_Prompt = """\
根据以下文本内容，分析出所有角色及其属性信息，严格按照以下格式要求：

<<角色状态格式要求>>
1. 必须包含以下五个分类（按顺序）：
   ● 物品 ● 能力 ● 状态 ● 主要角色间关系网 ● 触发或加深的事件
2. 每个属性条目必须用【名称: 描述】格式
   例：├──青衫: 一件破损的青色长袍，带有暗红色污渍
3. 状态必须包含：
   ● 身体状态: [当前身体状况]
   ● 心理状态: [当前心理状况]
4. 关系网格式：
   ● [角色名称]: [关系类型，如"竞争对手"/"盟友"]
5. 触发事件格式：
   ● [事件名称]: [简要描述及影响]

<<示例>>
李员外:
├──物品:
│  ├──青衫: 一件破损的青色长袍，带有暗红色污渍
│  └──寒铁长剑: 剑身有裂痕，刻有「青云」符文
├──能力:
│  ├──精神感知: 能感知半径30米内的生命体
│  └──剑气压制: 通过目光释放精神威压
├──状态:
│  ├──身体状态: 右臂有未愈合的刀伤
│  └──心理状态: 对苏明远的实力感到忌惮
├──主要角色间关系网:
│  ├──苏明远: 竞争对手，十年前的同僚
│  └──林婉儿: 暗中培养的继承人
├──触发或加深的事件:
│  ├──兵器库遇袭: 丢失三把传家宝剑，影响战力
│  └──匿名威胁信: 信纸带有檀香味，暗示内部泄密
│

请严格按上述格式分析以下内容：
<<待分析小说文本开始>>
{content}
<<待分析小说文本结束>>
"""
# =============== 10、小说分卷设计（分卷提示词） ===================
volume_outline_prompt = """\
基于以下元素：
- 小说主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 角色状态：{character_state}
- 核心人物(可能未指定)：{characters_involved}
- 总章节数：{number_of_chapters}
- 每章字数：{word_number}

请生成第一卷分卷大纲，需包含：
1. 卷名与主题：
   - 体现本卷核心冲突的卷名
   - 用1句话概括本卷主题

2. 世界观展开：
   - 本卷重点展现的世界观维度（物理/社会/隐喻）
   - 关键世界观揭示节点（3-5个）
   - 世界观与角色决策的互动设计

3. 情节架构：
   - 起始事件：打破平衡的关键点
   - 发展脉络：3-5个关键转折节点
   - 高潮设计：本卷最高冲突场景（需体现世界观特性）
   - 收尾悬念：留给下一卷的未解之谜

4. 角色发展：
   - 主要角色在本卷的成长弧线
   - 重要关系变化节点

5. 章节分布：
   - 本卷包含的章节范围
   - 各章节集群的核心作用
   - 每章节集群对应的世界观展现重点

输出格式：
第一卷《[卷名]》  第{x}章 至 第{y}章
├── 主题：[本卷主题]
├── 世界观展现
│   ├── 核心维度：[物理/社会/隐喻维度选择]
│   ├── 揭示节点：
│   │   ├─ [节点1]：[世界观要素]（第X章）
│   │   ├─ [节点2]：[世界观要素]（第Y章）
│   │   ├─ [节点3]：...
│   │   └─ ...
│   └── 互动设计：[角色决策如何受世界观影响]
├── 情节主线
│   ├── 起始：[起始事件]
│   ├── 发展：[转折点1]→[转折点2]→...
│   ├── 高潮：[高潮场景]（含世界观特性）
│   └── 悬念：[收尾悬念]
├── 角色演变
│   ├── [角色A]：[初始状态]→[关键转变]→[卷末状态]
│   ├── [角色B]：[初始状态]→[关键转变]→[卷末状态]
│   └── ...
└── 章节规划
    ├── 第X章-第Y章：[集群功能]（世界观重点：[具体维度]）
    └── 第Z章-第W章：[集群功能]（世界观重点：[具体维度]）


仅返回大纲文本，不要解释任何内容。
"""

subsequent_volume_prompt = """\
基于以下元素：
- 小说主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 角色状态：{character_state}
- 核心人物(可能未指定)：{characters_involved}
- 前卷大纲：{previous_volume_outline}
- 总章节数：{number_of_chapters}
- 每章字数：{word_number}

请生成第{volume_number}卷分卷大纲，作为过渡卷需要重点考虑：
1. 卷名与主题：
   - 体现本卷核心冲突的卷名
   - 用1句话概括本卷主题

2. 世界观深化：
   - 本卷新增的世界观维度
   - 世界观矛盾爆发点（2-3个）
   - 世界观规则对情节的限制与推动

3. 情节架构：
   - 承接上卷：如何解决上卷悬念（含世界观解释）
   - 新增危机：本卷核心冲突（需结合世界观）
   - 发展脉络：3-5个关键转折节点
   - 高潮设计：本卷最高冲突场景（体现世界观规则）
   - 收尾悬念：留给下一卷的未解之谜

4. 角色发展：
   - 主要角色在本卷的成长弧线
   - 重要关系变化节点

5. 章节分布：
   - 本卷包含的章节范围
   - 各章节集群的核心作用
   - 世界观展现的递进关系

输出格式：
第{volume_number}卷《[卷名]》  第{x}章 至 第{y}章
├── 主题：[本卷主题]
├── 世界观深化
│   ├── 新增维度：[新增世界观维度]
│   ├── 矛盾点：
│   │   ├─ [矛盾1]：（第X章爆发）
│   │   ├─ [矛盾2]：（第Y章解决）
│   │   └─ ...
│   └── 规则影响：[具体如何推动/限制情节]
├── 情节主线
│   ├── 承前：[解决上卷悬念]（含世界观解释）
│   ├── 启后：[新增危机]（结合世界观）
│   ├── 发展：[转折点1]→[转折点2]→...
│   ├── 高潮：[高潮场景]（体现世界观规则）
│   └── 悬念：[收尾悬念]
├── 角色演变
│   ├── [角色A]：[初始状态]→[关键转变]→[卷末状态]
│   ├── [角色B]：[初始状态]→[关键转变]→[卷末状态]
│   └── ...
└── 章节规划
    ├── 第X章-第Y章：[集群功能]（世界观递进：[具体表现]）
    └── 第Z章-第W章：[集群功能]（世界观递进：[具体表现]）

仅返回大纲文本，不要解释任何内容。
"""

final_volume_prompt = """\
基于以下元素：
- 小说主题：{topic}
- 内容指导：{user_guidance}
- 小说设定：{novel_setting}
- 角色状态：{character_state}
- 核心人物(可能未指定)：{characters_involved}
- 前卷大纲：{previous_volume_outline}
- 总章节数：{number_of_chapters}
- 每章字数：{word_number}

请生成最终卷分卷大纲，作为收官卷需要重点考虑：
1. 卷名与主题：
   - 体现最终冲突的卷名
   - 用1句话概括本卷主题

2. 世界观终局：
   - 所有世界观维度的收束方案
   - 终极世界观真相揭示节点
   - 世界观与角色命运的交织设计

3. 情节架构：
   - 终极危机：所有矛盾的总爆发（含世界观崩溃点）
   - 最终决战：多层次高潮设计（需运用世界观规则）
   - 核心伏笔：所有重要伏笔的回收方案（含世界观类伏笔）
   - 结局处理：2-3种可能的结局方向（体现世界观影响）

4. 角色终局：
   - 主要角色的最终状态
   - 重要关系的最终定位

5. 章节分布：
   - 本卷包含的章节范围
   - 各章节集群的核心作用
   - 世界观终局展现节奏


输出格式：
最终卷《[卷名]》  第{x}章 至 第{number_of_chapters}章
├── 主题：[本卷主题]
├── 世界观终局
│   ├── 维度收束：
│   │   ├─ [物理维度]：[解决方案]
│   │   ├─ [社会维度]：[解决方案]
│   │   └─ [隐喻维度]：[终极意象]
│   ├── 真相揭示：[关键章节]（第X章）
│   └── 命运交织：[具体设计]
├── 情节主线
│   ├── 危机：[终极危机]（含世界观崩溃点）
│   ├── 决战：[高潮设计]（运用世界观规则）
│   ├── 伏笔：[伏笔回收方案]（含世界观类）
│   └── 结局：[结局方向1]/[结局方向2]（世界观影响）
├── 角色终局
│   ├── [角色A]：[最终状态]
│   ├── [角色B]：[最终状态]
│   └── ...
└── 章节规划
    ├── 第X章-第Y章：[集群功能]（世界观展现：[重点]）
    ├── 第Z章-第W章：[集群功能]（世界观展现：[重点]）
    ├── ...
    └── 终章：[功能]（世界观终局呈现）
    
仅返回大纲文本，不要解释任何内容。
"""

# =============== 11. 章节改写与扩写提示词 ====================
chapter_rewrite_prompt = """\
【改写扩写操作台】

◆ 第{novel_number}章《{chapter_title}》
  字数要求：{word_number}
  分卷大纲｜{volume_outline}

◆ 改写维度：
□ 叙事增强：
  1. 伏笔密度提升：在现有对话中植入{number_of_chapters}处双关隐喻（需关联分卷大纲)
  2. 感官渗透：在{scene_location}场景增加{emotion_evolution}对应的3类感官细节
  3. 非线性叙事：插入1段记忆闪回（需使用{key_items}作为触发媒介）

□ 冲突升级：
  - 强化主要角色的价值观对立（{chapter_purpose}相关）
  - 将现有冲突拆分为{plot_twist_level}级转折序列
  - 在环境描写中预埋{next_chapter_foreshadowing}的2处暗示

【操作规范】
▷ 必须遵守：
  1. 保持{chapter_role}的叙事视角一致性
  2. {user_guidance}风格强化（对话/描写比例调整）
  3. 预留{branch_clues}处分支线索接口

▷ 禁止事项：
  ✖ 不得更改分卷大纲相关核心设定
  ✖ 不得破坏主要角色的行为动机链
  ✖ 不得移除世界观的关键环境要素

【增强包注入】
⇒ 世界观渗透：
⇒ 角色弧光：通过习惯性动作强化主要角色人物的特质
⇒ 悬念维护：确保伏笔的回收进度符合分卷大纲的节点要求

原始草稿｜{raw_draft} 

生成要求：
1. 保留原始草稿原本正文中70%核心内容
2. 新增内容需通过{knowledge_filter_prompt}校验
3. 最终版本必须达成{chapter_purpose}的100%完成度

（输出纯文本扩写版，禁用任何格式标记，不要解释任何内容）
"""